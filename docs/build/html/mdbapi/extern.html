

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MusicDBExtern &mdash; MusicDB 1.0.0 beta documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="MusicDB 1.0.0 beta documentation" href="../index.html"/>
        <link rel="next" title="LyCra - Lyrics Crawler" href="lycra.html"/>
        <link rel="prev" title="MusicDBDatabase" href="database.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> MusicDB
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/comparison.html">Comparison to Other Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/comparison.html#introducing-other-tools">Introducing other tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/comparison.html#metrics">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/comparison.html#comparison">Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/comparison.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basics/concept.html">Basic Rules for MusicDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/config.html">MusicDB Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#server">server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#websocket">websocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#tls">TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#database">database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#music">music</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#artwork">artwork</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#extern">extern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#tracker">tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#lycra">lycra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#mpd">MPD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#musicai">MusicAI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#randy">Randy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#log">log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/config.html#debug">debug</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basics/logging.html">Handling log-files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/mods.html">MusicDB Commandline Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/mods.html#loading-of-modules">Loading of Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/mods.html#creation-of-new-modules">Creation of new Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basics/testvm.html">MusicDB Test VMs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/testvm.html#qemu-installation">qemu Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/testvm.html#basic-setup">Basic Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/testvm.html#disk-images">Disk Images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/testvm.html#system-setup">System Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/testvm.html#installing-updating-musicdb-test-environment">Installing/Updating MusicDB Test Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/testvm.html#create-dummy-files">Create Dummy Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/testvm.html#test-systems">Test Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/testvm.html#debian">Debian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/testvm.html#raspian">Raspian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/testvm.html#arch-linux">Arch Linux</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basics/webapi.html">MusicDB Websocket API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/webapi.html#communication">Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#packet-format">Packet format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#methods">Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/webapi.html#client-side-interface">Client side interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#callback-functions">Callback functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#send-data-to-the-server">Send data to the server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/webapi.html#module-lib.ws.mdbwsi">Server side API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#artists">Artists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#albums">Albums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#songs">Songs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#queue">Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#tag-related">Tag related</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#lyrics">Lyrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/webapi.html#other">Other</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basics/workflow.html">Workflow for development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/workflow.html#working-on-code">Working on code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/workflow.html#rebuilding-the-documentation">Rebuilding the Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/workflow.html#using-git">Using git</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/workflow.html#micro-commits">Micro Commits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/workflow.html#createing-a-hotfix">Createing a Hotfix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/workflow.html#merging-develop-to-master">Merging Develop to Master</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/workflow.html#releasing-a-new-version">Releasing a New Version</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/install.html">Installation &amp; Update</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/install.html#installation-automatic">Installation (Automatic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#install-dependencies">Install Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#executing-the-install-sh-script">Executing the install.sh Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#install-all-dependencies">Install all Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#configureing-musicdb">Configureing MusicDB</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/install.html#installation-manually">Installation (Manually)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#system-preparation">System Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#id1">Install dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#basic-packages">Basic packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#mpd-music-player-daemon">MPD - Music Player Daemon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#apache-http-server">Apache HTTP-Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#download-musicdb">Download MusicDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#libprinthex">libprinthex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#id3edit">id3edit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/install.html#musicdb">musicdb</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/install.html#configureing-musicdb-webui">Configureing MusicDB WebUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/install.html#cuda-for-musicai">CUDA for MusicAI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/install.html#first-run">First Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/install.html#update">Update</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/music.html">Music</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/music.html#naming">Naming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/music.html#artist-directory">Artist Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/music.html#album-directory">Album Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/music.html#song-file">Song File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/music.html#importing-albums-to-the-collection">Importing Albums to the Collection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/music.html#itunes">iTunes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/music.html#bandcamp">Bandcamp</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/music.html#importing-albums-to-musicdb">Importing Albums to MusicDB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/music.html#using-the-database-module">Using the database module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/music.html#using-the-repair-module">Using the repair module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/music.html#updating-songs">Updating Songs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/scripts.html">Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/scripts.html#musicdb-boot">musicdb-boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/scripts.html#musicdb-shutdown">musicdb-shutdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/scripts.html#musicdb-start">musicdb-start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/scripts.html#musicdb-stop">musicdb-stop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/scripts.html#quickupdate">quickupdate</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">CLI Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mod/artwork.html">artwork - Artwork Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mod/artwork.html#class">class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mod/database.html">database - Music DB Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mod/extern.html">extern - Music File Uploader</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mod/extern.html#class">class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mod/extern.html#automatization">Automatization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mod/genres.html">genres - Genre Manager with CLUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mod/metadata.html">metadata - Metadata Reader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mod/mise.html">mise - Micro Search Engine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mod/mise.html#class">class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mod/moods.html">moods - Mood Tag Manager with CLUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mod/musicai.html">musicai - MusicAI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mod/musicai.html#module-mod.musicai">Module Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mod/musicai.html#class-description">Class Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mod/repair.html">repair - Repair Database Entries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mod/server.html">server - MusicDB Websocket Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mod/stats.html">stats - MusicDB Song Statistic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mod/tags.html">tags - MusicDB Tag Manager</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mod/tags.html#main-commands">Main commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mod/tags.html#style-guide">Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mod/tags.html#example-calls">Example calls</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mod/tracker.html">tracker - Song Tracker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mod/tracker.html#module-mod.tracker">Module Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mod/tracker.html#class-description">Class Description</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Classes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="artwork.html">Artwork Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="artwork.html#database">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="artwork.html#path-structure">Path structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="artwork.html#webbrowsers">Webbrowsers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="artwork.html#scaling">Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="artwork.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="artwork.html#manifest">Manifest</a></li>
<li class="toctree-l2"><a class="reference internal" href="artwork.html#algorithm">Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="artwork.html#musicdbartwork-class">MusicDBArtwork Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="artwork.html#module-lib.cache">ArtworkCache Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="database.html">MusicDBDatabase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="database.html#musicdbdatabase-class">MusicDBDatabase Class</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MusicDBExtern</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#initializing-a-storage">Initializing a Storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#storage-configuration">Storage Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-state-file">The State-File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#updating-a-storage">Updating a Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-toxic-environments">Handling Toxic Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#musicdbextern-class">MusicDBExtern Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lycra.html">LyCra - Lyrics Crawler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="lycra.html#module-mdbapi.lycra">Lycra API Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="lycra.html#crawler-base-class">Crawler Base Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="lycra.html#module-lib.db.lycradb">Lycra Database</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mise.html">Micro Search Engine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mise.html#musicdbmicrosearchengine-class">MusicDBMicroSearchEngine Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mpd.html">mpd / Music Playing Daemon Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mpd.html#interface">Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpd.html#observer-thread">Observer Thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpd.html#callbacks">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpd.html#managing-mpd">Managing MPD</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpd.html#queue-management">Queue management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="musicai.html">MusicAI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="musicai.html#external-dependencies">External Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="musicai.html#training-time">Training Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="musicai.html#removing-an-old-model">Removing an old model</a></li>
<li class="toctree-l2"><a class="reference internal" href="musicai.html#data-handling">Data Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="musicai.html#featureset">Featureset</a></li>
<li class="toctree-l3"><a class="reference internal" href="musicai.html#trainingset">Trainingset</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="musicai.html#module-mdbapi.musicai">MusicAI Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="musicai.html#musicai-class">MusicAI Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="randy.html">Randomizer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="randy.html#module-mdbapi.randy">Randy Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="randy.html#randyinterface-class">RandyInterface Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="server.html">MusicDB Websocket Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="tags.html">MusicDBTags</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tags.html#musicdbtags-class">MusicDBTags Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tracker.html">Song Tracker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tracker.html#trackerinterface-class">TrackerInterface Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracker.html#module-lib.db.trackerdb">Tracker Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracker.html#trackerdatabase-class">TrackerDatabase Class</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lib/clui.html">Command Line User Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.text">Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.frame">Frame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.pane">Pane</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.buttonview">ButtonView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.listview">ListView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.dialog">Dialog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.textinput">TextInput</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.boolinput">BoolInput</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/clui.html#module-lib.clui.tabgroup">TabGroup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lib/config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/config.html#module-lib.cfg.config">Base Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/config.html#musicdb-configuration">MusicDB Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/config.html#module-lib.cfg.extern">External Storage Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/config.html#module-lib.cfg.mdbstate">MusicDB State</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lib/database.html">Database</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/database.html#database-class">Database Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lib/filesystem.html">Filesystem Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/filesystem.html#filesystem-class">Filesystem Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lib/hdf5storage.html">HDF5Storage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/hdf5storage.html#hdf5storage-class">HDF5Storage Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lib/metatags.html">Meta Tags</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/metatags.html#metatags-class">MetaTags Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lib/musicdb.html">MusicDatabase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/musicdb.html#adding-a-column">Adding a Column</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/musicdb.html#songs">Songs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/musicdb.html#albums">Albums</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../lib/musicdb.html#album-related-methods">Album Related Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/musicdb.html#artworks">Artworks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/musicdb.html#origin">Origin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lib/musicdb.html#artists">Artists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/musicdb.html#lyrics">Lyrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/musicdb.html#tags">Tags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../lib/musicdb.html#tag-definition-table">Tag Definition Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/musicdb.html#tag-mapping-table">Tag Mapping Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/musicdb.html#database-api">Database API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lib/musicdb.html#musicdatabase-class">MusicDatabase Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lib/pidfile.html">PID File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lib/websockets.html">MusicDB Websocket Protocol</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/websockets.html#module-lib.ws.server">Websocket Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/websockets.html#module-lib.ws.websocket">Websocket Protocol</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">JaveScript Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../webui/taginput.html">Tag Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webui/taginput.html#taginput-js">taginput.js</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webui/taginput.html#files">Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webui/taginput.html#musicdb-interface">MusicDB Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webui/taginput.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webui/taginput.html#tagmanager-js">tagmanager.js</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webui/taginput.html#id1">Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webui/taginput.html#id2">MusicDB Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webui/taginput.html#id3">Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webui/websockets.html">Websocket Connection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webui/websockets.html#connection-process">Connection Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webui/websockets.html#watchdog">Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webui/websockets.html#communication-with-the-server">Communication with the server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webui/websockets.html#sending-data">Sending Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webui/websockets.html#receiving-data">Receiving Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webui/websockets.html#minimal-usage">Minimal usage</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/impressum.html">Impressum</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#angaben-gemasz-5-tmg">Angaben gemäß § 5 TMG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#kontakt">Kontakt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#verantwortlich-fur-den-inhalt-nach-55-abs-2-rstv">Verantwortlich für den Inhalt nach § 55 Abs. 2 RStV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#haftung-fur-inhalte">Haftung für Inhalte</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#haftung-fur-links">Haftung für Links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#urheberrecht">Urheberrecht</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../other/impressum.html#datenschutzerklarung">Datenschutzerklärung</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#datenschutz">Datenschutz</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#cookies">Cookies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#server-log-files">Server-Log-Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#facebook-plugins-like-button">Facebook-Plugins (Like-Button)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#twitter">Twitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#google">Google+</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#youtube">YouTube</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#ssl-verschlusselung">SSL-Verschlüsselung</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/impressum.html#widerspruch-werbe-mails">Widerspruch Werbe-Mails</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MusicDB</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>MusicDBExtern</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/mdbapi/extern.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-mdbapi.extern">
<span id="musicdbextern"></span><h1>MusicDBExtern<a class="headerlink" href="#module-mdbapi.extern" title="Permalink to this headline">¶</a></h1>
<p>This class handles the upload of music files to external storages.
Before most of the methods can be used, the mountpoint of the external storage must be set using <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.SetMountpoint" title="mdbapi.extern.MusicDBExtern.SetMountpoint"><code class="xref py py-meth docutils literal"><span class="pre">SetMountpoint()</span></code></a>.
The default mount poiunt is <code class="docutils literal"><span class="pre">&quot;/mnt&quot;</span></code>.
There are three main tasks this class implements:</p>
<ul class="simple">
<li><a class="reference internal" href="#initializing-a-storage">Initializing a Storage</a></li>
<li><a class="reference internal" href="#updating-a-storage">Updating a Storage</a></li>
<li><a class="reference internal" href="#handling-toxic-environments">Handling Toxic Environments</a></li>
</ul>
<div class="section" id="initializing-a-storage">
<h2>Initializing a Storage<a class="headerlink" href="#initializing-a-storage" title="Permalink to this headline">¶</a></h2>
<p>Each storage must have a directory configured in the main MusicDB-Configuration, that holds some states.
This directory can be created and initialized using the <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.InitializeStorage" title="mdbapi.extern.MusicDBExtern.InitializeStorage"><code class="xref py py-meth docutils literal"><span class="pre">InitializeStorage()</span></code></a>.
It is possible to check if the storage was already initialized using the method <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.IsStorageInitialized" title="mdbapi.extern.MusicDBExtern.IsStorageInitialized"><code class="xref py py-meth docutils literal"><span class="pre">IsStorageInitialized()</span></code></a>.</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">database</span> <span class="o">=</span> <span class="n">MusicDatabase</span><span class="p">(</span><span class="s2">&quot;./music.db&quot;</span><span class="p">)</span>
<span class="n">config</span>   <span class="o">=</span> <span class="n">MusicDBConfig</span><span class="p">(</span><span class="s2">&quot;./musicdb.ini&quot;</span><span class="p">)</span>
<span class="n">extern</span>   <span class="o">=</span> <span class="n">MusicDBExtern</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
<span class="n">extern</span><span class="o">.</span><span class="n">SetMountpoint</span><span class="p">(</span><span class="s2">&quot;/mnt&quot;</span><span class="p">)</span>

<span class="c1"># Initialize mounted storage if not done yet</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">extern</span><span class="o">.</span><span class="n">IsStorageInitialized</span><span class="p">():</span>
    <span class="n">extern</span><span class="o">.</span><span class="n">InitializeStorage</span><span class="p">()</span>
</pre></div>
</div>
<p>After initializing, a directory is created and a bare <em>config.ini</em> is copied from the <em>MusicDB share directory</em>.
The name of the directory, the config-source-file and the state-file-names can be configured in the MusicDB-Config file.
It is recommended to use a hidden directory for the states on the external storage.
MusicDB must have write access to the directory and its files.</p>
<div class="section" id="storage-configuration">
<h3>Storage Configuration<a class="headerlink" href="#storage-configuration" title="Permalink to this headline">¶</a></h3>
<p>The storage configuration can be used to adapt to the environment other software or devices require to use the music that will be stored on it.
More details about <a class="reference internal" href="#handling-toxic-environments">Handling Toxic Environments</a> can be found in the related subsection.</p>
<p>Template for such a storage configuration:</p>
<blockquote>
<div><div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[meta]</span>
<span class="na">version</span><span class="o">=</span><span class="s">3</span>

<span class="k">[constraints]</span>
<span class="c1">; define the allowed charset:</span>
<span class="c1">;  * default: use the default chars that are used by the source (utf-8)</span>
<span class="c1">;  * FAT:     utf-8 without the chars forbidden by the FAT-Spec</span>
<span class="na">charset</span><span class="o">=</span><span class="s">FAT</span>

<span class="c1">; max path length (0 = infinity length)</span>
<span class="na">pathlen</span><span class="o">=</span><span class="s">256</span>

<span class="c1">; some really bad players like the one in my car do not allow other fileformats than mp3</span>
<span class="c1">; Set forcemp3 to True to convert all &quot;foreign&quot; encoded files to crappy mp3s</span>
<span class="na">forcemp3</span><span class="o">=</span><span class="s">True</span>

<span class="k">[paths]</span>
<span class="c1">; path for the music relative to the mountpoint - usually /</span>
<span class="c1">;  * /:      root directory of the external device</span>
<span class="c1">;  * /MUSIC: used by some over engineered firmware</span>
<span class="na">musicdir</span><span class="o">=</span><span class="s">/</span>

<span class="k">[mp3tags]</span>
<span class="c1">; Remove all unnecessary ID3 frames and use the values from the database</span>
<span class="na">optimize</span><span class="o">=</span><span class="s">True</span>

<span class="c1">; prescale the album cover (optimize must be True otherwise this option will be ignored)</span>
<span class="c1">; None:    No prescaling</span>
<span class="c1">; False:   No prescaling</span>
<span class="c1">; {X}x{Y}: Scale to XxY</span>
<span class="na">prescale</span><span class="o">=</span><span class="s">240x240</span>

<span class="c1">; if optimize=True, remove artwork if true</span>
<span class="na">noartwork</span><span class="o">=</span><span class="s">False</span>

<span class="c1">; Do not use the modern 2.4.0 version</span>
<span class="na">forceID3v230</span><span class="o">=</span><span class="s">False</span>

<span class="k">[m4atags]</span>
<span class="c1">; Update tags to database entries - EXPERIMENTAL!</span>
<span class="na">optimize</span><span class="o">=</span><span class="s">True</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="the-state-file">
<h3>The State-File<a class="headerlink" href="#the-state-file" title="Permalink to this headline">¶</a></h3>
<p>The state-file mostly called <em>songmap</em> is a Comma Separated Value (csv) file.
It contains a row for each song on the storage and is used to identify the song.
This is mandatory because the path on the external storage may differ from the paths of the music collection.
This can happen for example by transcoding or renaming to a FAT compatible path.</p>
<p>Each row has the following columns:</p>
<blockquote>
<div><ul class="simple">
<li>Original file path (relative)</li>
<li>File path on the external storage (relative)</li>
</ul>
</div></blockquote>
<p>The csv file must have the following dialect:</p>
<blockquote>
<div><ul class="simple">
<li>delimiter:  <code class="docutils literal"><span class="pre">,</span></code></li>
<li>escapechar: <code class="docutils literal"><span class="pre">\</span></code></li>
<li>quotechar:  <code class="docutils literal"><span class="pre">&quot;</span></code></li>
<li>quoting:    <code class="docutils literal"><span class="pre">csv.QUOTE_NONNUMERIC</span></code></li>
</ul>
</div></blockquote>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="s2">&quot;Rammstein/2001 - Mutter/03 Sonne.m4a&quot;</span><span class="p">,</span><span class="s2">&quot;Rammstein/2001 - Mutter/03 Sonne.mp3&quot;</span>
</pre></div>
</div>
<p>This file gets generated by the method <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.WriteSongmap" title="mdbapi.extern.MusicDBExtern.WriteSongmap"><code class="xref py py-meth docutils literal"><span class="pre">WriteSongmap()</span></code></a>
and can be read by <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.ReadSongmap" title="mdbapi.extern.MusicDBExtern.ReadSongmap"><code class="xref py py-meth docutils literal"><span class="pre">ReadSongmap()</span></code></a>.
Usually the user should never touch this file.</p>
</div>
</div>
<div class="section" id="updating-a-storage">
<h2>Updating a Storage<a class="headerlink" href="#updating-a-storage" title="Permalink to this headline">¶</a></h2>
<p>Updating an external storage device like a mp3-player or a SD-Card, the <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.UpdateStorage" title="mdbapi.extern.MusicDBExtern.UpdateStorage"><code class="xref py py-meth docutils literal"><span class="pre">UpdateStorage()</span></code></a> method can be used.</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">database</span> <span class="o">=</span> <span class="n">MusicDatabase</span><span class="p">(</span><span class="s2">&quot;./music.db&quot;</span><span class="p">)</span>
<span class="n">config</span>   <span class="o">=</span> <span class="n">MusicDBConfig</span><span class="p">(</span><span class="s2">&quot;./musicdb.ini&quot;</span><span class="p">)</span>
<span class="n">extern</span>   <span class="o">=</span> <span class="n">MusicDBExtern</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
<span class="n">extern</span><span class="o">.</span><span class="n">SetMountpoint</span><span class="p">(</span><span class="s2">&quot;/mnt&quot;</span><span class="p">)</span>

<span class="c1"># Update storage if it is valid</span>
<span class="k">if</span> <span class="n">extern</span><span class="o">.</span><span class="n">IsStorageInitialized</span><span class="p">():</span>
    <span class="n">extern</span><span class="o">.</span><span class="n">UpdateStorage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="handling-toxic-environments">
<h2>Handling Toxic Environments<a class="headerlink" href="#handling-toxic-environments" title="Permalink to this headline">¶</a></h2>
<p>A <em>toxic environment</em> is a device that has some limitations and constraints the exported music has to fulfill.
For example, my car can only read mp3 files, has a path length limit of 256 characters and can only access a FAT filesystem.
My mp3-player does not have that many constraints, but slows down if the album covers are too large and have to be scaled down the mp3 players screen resolution.
Those limitations can be handled by MusicDBExtern.</p>
<p>There are several methods to handle toxic environments.
They can be activated in the config file that will be generated when the storage gets initialized.</p>
<p>The following methods will be applied if activated in the config:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.ReducePathLength" title="mdbapi.extern.MusicDBExtern.ReducePathLength"><code class="xref py py-meth docutils literal"><span class="pre">ReducePathLength()</span></code></a> if the pathlength is limited</li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.ConvertToMP3" title="mdbapi.extern.MusicDBExtern.ConvertToMP3"><code class="xref py py-meth docutils literal"><span class="pre">ConvertToMP3()</span></code></a> if only mp3-files are allowed</li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.OptimizeMP3Tags" title="mdbapi.extern.MusicDBExtern.OptimizeMP3Tags"><code class="xref py py-meth docutils literal"><span class="pre">OptimizeMP3Tags()</span></code></a> to scale artwork and make proper ID3 tags</li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.OptimizeM4ATags" title="mdbapi.extern.MusicDBExtern.OptimizeM4ATags"><code class="xref py py-meth docutils literal"><span class="pre">OptimizeM4ATags()</span></code></a> make proper meta tags for m4a files</li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.FixPath" title="mdbapi.extern.MusicDBExtern.FixPath"><code class="xref py py-meth docutils literal"><span class="pre">FixPath()</span></code></a> to handle unicode in paths</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When optimizing M4A-Tags, the album artwork gets lost.
This is a <a class="reference external" href="https://trac.ffmpeg.org/ticket/2798">bug</a> in <code class="docutils literal"><span class="pre">ffmpeg</span></code>. I did not find any good workarounds yet.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="musicdbextern-class">
<h2>MusicDBExtern Class<a class="headerlink" href="#musicdbextern-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="mdbapi.extern.MusicDBExtern">
<em class="property">class </em><code class="descclassname">mdbapi.extern.</code><code class="descname">MusicDBExtern</code><span class="sig-paren">(</span><em>config</em>, <em>database</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>config</strong> – MusicDB configuration object</li>
<li><strong>database</strong> – MusicDB database</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal"><span class="pre">TypeError</span></code> – when <em>config</em> or <em>database</em> not of type <a class="reference internal" href="../lib/config.html#lib.cfg.musicdb.MusicDBConfig" title="lib.cfg.musicdb.MusicDBConfig"><code class="xref py py-class docutils literal"><span class="pre">MusicDBConfig</span></code></a> or <a class="reference internal" href="../lib/musicdb.html#lib.db.musicdb.MusicDatabase" title="lib.db.musicdb.MusicDatabase"><code class="xref py py-class docutils literal"><span class="pre">MusicDatabase</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.ConvertToMP3">
<code class="descname">ConvertToMP3</code><span class="sig-paren">(</span><em>abssrcpath</em>, <em>absdstpath</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.ConvertToMP3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.ConvertToMP3" title="Permalink to this definition">¶</a></dt>
<dd><p>This method converts any filetype to an mp3 file using <code class="docutils literal"><span class="pre">ffmpeg</span></code>.
All paths must be absolute!</p>
<p>The encoder is <em>libmp3lame</em> and the bitrate is esoteric 320kbit/s.
If the destination file exists, it will be overwritten.</p>
<p>This method corresponds to the following command line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ffmpeg -v quiet -y -i <span class="nv">$abssrcpath</span> -acodec libmp3lame -ab 320k <span class="nv">$absdstpath</span> &lt; /dev/null &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Call <code class="docutils literal"><span class="pre">os.sync</span></code> if the generated file will be further processed.
In the past, there were lots of trouble with “incomplete” files.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>abssrcpath</strong> (<em>str</em>) – absolute source path of a song file with any encoding</li>
<li><strong>absdstpath</strong> (<em>str</em>) – absolute destination path of the new generated song file with mp3 encoding.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal"><span class="pre">True</span></code> on success, otherwise <code class="docutils literal"><span class="pre">False</span></code></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.CopyNewSongs">
<code class="descname">CopyNewSongs</code><span class="sig-paren">(</span><em>songmap</em>, <em>extconfig</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.CopyNewSongs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.CopyNewSongs" title="Permalink to this definition">¶</a></dt>
<dd><p>This method handles the songs that are new to the collection and not yet copied to the external storage.
The process is split into two tasks:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Generate path names for the new files on the external storage</li>
<li>Copy the songs to the external storage</li>
</ol>
</div></blockquote>
<p>The copy-process itself is done in another method <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.CopySong" title="mdbapi.extern.MusicDBExtern.CopySong"><code class="xref py py-meth docutils literal"><span class="pre">CopySong()</span></code></a>.
In future, the <code class="docutils literal"><span class="pre">CopySong</span></code> method shall be called simultaneously for multiple songs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>songmap</strong> – A list of tuples representing the external storage state.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><em>songmap</em> with the new state of the storage. The dstpath-column is set for the copied songs.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.CopySong">
<code class="descname">CopySong</code><span class="sig-paren">(</span><em>relsrcpath</em>, <em>reldstpath</em>, <em>extconfig</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.CopySong"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.CopySong" title="Permalink to this definition">¶</a></dt>
<dd><p>In this method, the copy process is done. This method is the core of this class.
The copy process is done in several steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Preparation of all paths and configurations</li>
<li>Create missing directories</li>
<li>Transcode, optimize, copy file</li>
</ol>
</div></blockquote>
<p>It also creates the Artist and Album directory if they do not exist.
If a song file already exists, the copy-process gets skipped.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>relsrcpath</strong> (<em>str</em>) – relative source path to the song that shall be copied</li>
<li><strong>reldstpath</strong> (<em>str</em>) – relative destination path. Its extension may be changed due to transcoding.</li>
<li><strong>extconfig</strong> – Instance of the external storage configuration</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">On success the updated <code class="docutils literal"><span class="pre">reldstpath</span></code> is returned. It may differ from the parameter due to transcoding the file. Otherwise <code class="docutils literal"><span class="pre">None</span></code> is returned.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.FixPath">
<code class="descname">FixPath</code><span class="sig-paren">(</span><em>string</em>, <em>charset</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.FixPath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.FixPath" title="Permalink to this definition">¶</a></dt>
<dd><p>This method places characters that are invalid for <em>charset</em> by a valid one.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Replaces <code class="docutils literal"><span class="pre">?&lt;&gt;\:*|&quot;</span></code> by <code class="docutils literal"><span class="pre">_</span></code></li>
<li>Replaces <code class="docutils literal"><span class="pre">äöüÄÖÜß</span></code> by <code class="docutils literal"><span class="pre">aouAOUB</span></code></li>
</ol>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Obviously, this method is incomplete and full of shit. It must and will be replaced in future.</p>
</div>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">FixPath</span><span class="p">(</span><span class="s2">&quot;FAT/is f*cking/scheiße.mp3&quot;</span><span class="p">)</span>
<span class="c1"># returns &quot;FAT/is f_cking/scheiBe.mp3&quot;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>string</strong> (<em>str</em>) – string that shall be fixed</li>
<li><strong>charset</strong> (<em>str</em>) – until now, only <code class="docutils literal"><span class="pre">&quot;FAT&quot;</span></code> is considered. Other sets will be ignored</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A string that is valid for <em>charset</em></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.InitializeStorage">
<code class="descname">InitializeStorage</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.InitializeStorage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.InitializeStorage" title="Permalink to this definition">¶</a></dt>
<dd><p>This method creates the state-directory inside the mountpoint.
Then a template of the storage configuration gets copied inside the new creates state-directory</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><code class="docutils literal"><span class="pre">True</span></code> on success, else <code class="docutils literal"><span class="pre">False</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.IsStorageInitialized">
<code class="descname">IsStorageInitialized</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.IsStorageInitialized"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.IsStorageInitialized" title="Permalink to this definition">¶</a></dt>
<dd><p>This method checks for the state-directory and the storage configuration file inside the state directory.
If both exists, the storage is considered as initialized and <code class="docutils literal"><span class="pre">True</span></code> gets returned.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><code class="docutils literal"><span class="pre">True</span></code> if storage is initialized, otherwise <code class="docutils literal"><span class="pre">False</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.OptimizeM4ATags">
<code class="descname">OptimizeM4ATags</code><span class="sig-paren">(</span><em>mdbsong</em>, <em>abssrcpath</em>, <em>absdstpath</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.OptimizeM4ATags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.OptimizeM4ATags" title="Permalink to this definition">¶</a></dt>
<dd><p>This method fixes the Tags of an m4a file.
The data for the Tags come from the MusicDBDatabase.
For writing the new tags, <code class="docutils literal"><span class="pre">ffmpeg</span></code> is used.
The call of <code class="docutils literal"><span class="pre">ffmpeg</span></code> corresponds to the following command line that got condensed to just setting the songname.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>ffmpeg -v quiet -y -i <span class="nv">$abssrcpath</span> -vn -acodec copy -metadata <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;Name of the Song&quot;</span> <span class="nv">$absdstpath</span> &lt; /dev/null &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</pre></div>
</div>
</div></blockquote>
<p>The following tags will be set:</p>
<blockquote>
<div><ul class="simple">
<li>Song name</li>
<li>Album name</li>
<li>Artist name</li>
<li>Release date</li>
<li>Track number</li>
<li>CD number</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Other tags could be removed - I don’t care about them.
If <code class="docutils literal"><span class="pre">ffmpeg</span></code> also doesn’t care, they are lost.
This will definitely happen with iTunes related tags like the Apple ID and purchase-date.</p>
<p><strong>Artwork will be removed, too</strong> :( - This is considered as a bug. I just have no solution to fix it right now.</p>
<p class="last">The following code should preserve the artwork but throws an error:
<code class="docutils literal"><span class="pre">ffmpeg</span> <span class="pre">-y</span> <span class="pre">-i</span> <span class="pre">src.m4a</span> <span class="pre">-map</span> <span class="pre">0:0</span> <span class="pre">-map</span> <span class="pre">0:1</span> <span class="pre">-vcodec</span> <span class="pre">copy</span> <span class="pre">-acodec</span> <span class="pre">copy</span> <span class="pre">-metadata</span> <span class="pre">&quot;title=Title&quot;</span> <span class="pre">dst.m4a</span></code></p>
</div>
<p>Source and destination file must be different.
The source file must have the file extension <code class="docutils literal"><span class="pre">.m4a</span></code> or <code class="docutils literal"><span class="pre">.mp4</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>mdbsong</strong> – The corresponding song-object from the MusicDB Database</li>
<li><strong>abssrcpath</strong> (<em>str</em>) – absolute source path of the m4a-file (must be m4a!)</li>
<li><strong>absdstpath</strong> (<em>str</em>) – absolute destination path for the new m4a-file. (Must be different from the source path)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal"><span class="pre">True</span></code> on success, otherwise <code class="docutils literal"><span class="pre">False</span></code></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.OptimizeMP3Tags">
<code class="descname">OptimizeMP3Tags</code><span class="sig-paren">(</span><em>mdbsong</em>, <em>abssrcpath</em>, <em>absdstpath</em>, <em>artwork=True</em>, <em>prescale=None</em>, <em>forceID3v230=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.OptimizeMP3Tags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.OptimizeMP3Tags" title="Permalink to this definition">¶</a></dt>
<dd><p>This method fixed the ID3 tags of an mp3 file and scales its artwork.
The data for the ID3 tags come from the MusicDBDatabase.
For writing the new ID3 tags, <code class="docutils literal"><span class="pre">id3edit</span></code> is used.
The call of <code class="docutils literal"><span class="pre">id3edit</span></code> corresponds to the following command line, reduced to just setting the songname.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>id3edit --clear --create --set-name <span class="s2">&quot;Name of the Song&quot;</span> --outfile <span class="nv">$absdstpath</span> <span class="nv">$abssrcpath</span> &lt; /dev/null &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</pre></div>
</div>
</div></blockquote>
<p>The following tags will be set. All other will be removed.</p>
<blockquote>
<div><ul class="simple">
<li>Song name</li>
<li>Album name</li>
<li>Artist name</li>
<li>Release date</li>
<li>Track number</li>
<li>CD number</li>
<li>Artwork</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">All other tags will not be copied to the new file.
The <code class="docutils literal"><span class="pre">id3edit</span></code> call creates a totaly new <em>ID3v2</em> header for the mp3 file.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>mdbsong</strong> – The corresponding song-object from the MusicDB Database</li>
<li><strong>abssrcpath</strong> (<em>str</em>) – absolute source path of the mp3-file (must be mp3!)</li>
<li><strong>absdstpath</strong> (<em>str</em>) – absolute destination path for the new mp3-file. (Can be the same as the source path)</li>
<li><strong>artwork</strong> (<em>bool</em>) – if <code class="docutils literal"><span class="pre">True</span></code> the album artwork will be stored inside the ID3 tags. Otherwise it will be removed.</li>
<li><strong>prescale</strong> (<em>str</em>) – if not <code class="docutils literal"><span class="pre">None</span></code> the artwork will be scaled to <code class="docutils literal"><span class="pre">&quot;${resX}x${resY}&quot;</span></code>. An example value for <em>prescale</em> can be <code class="docutils literal"><span class="pre">&quot;256x256&quot;</span></code>.</li>
<li><strong>forceID3v230</strong> (<em>bool</em>) – use old ID3v2.3.0 tags instead of modern 2.4.0. Some player don’t like a version number other than 2.3.0.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal"><span class="pre">True</span></code> on success, otherwise <code class="docutils literal"><span class="pre">False</span></code></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.ReadSongmap">
<code class="descname">ReadSongmap</code><span class="sig-paren">(</span><em>mappath</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.ReadSongmap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.ReadSongmap" title="Permalink to this definition">¶</a></dt>
<dd><p>This method reads the song map that maps relative song paths from the collection to relative paths on the external storage.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>mappath</strong> (<em>str</em>) – absolute path to the songmap</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><code class="docutils literal"><span class="pre">None</span></code> if there is no songmap yet. Otherwise a list of tuples (srcpath, dstpath) is returned.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.ReducePathLength">
<code class="descname">ReducePathLength</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.ReducePathLength"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.ReducePathLength" title="Permalink to this definition">¶</a></dt>
<dd><p>This method reduces a path length to hopefully fit into a path-length-limit.
The reduction is done by removing the song name from the path.
Everything left is the directory the song is stored in, the song number and the file extension.</p>
<p class="rubric">Example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">ReducePathLength</span><span class="p">(</span><span class="s2">&quot;artist/album/01 very long name.mp3&quot;</span><span class="p">)</span>
<span class="c1"># returns &quot;artist/album/01.mp3&quot;</span>
<span class="bp">self</span><span class="o">.</span><span class="n">ReducePathLength</span><span class="p">(</span><span class="s2">&quot;artist/album/1-01 very long name.mp3&quot;</span><span class="p">)</span>
<span class="c1"># returns &quot;artist/album/1-01.mp3&quot;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<em>str</em>) – path of the song</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">shortend path as string if successfull, <code class="docutils literal"><span class="pre">None</span></code> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.RemoveOldSongs">
<code class="descname">RemoveOldSongs</code><span class="sig-paren">(</span><em>songmap</em>, <em>extconfig</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.RemoveOldSongs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.RemoveOldSongs" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all songs that have a destination-entry but no source-entry in the songmap.
This constellation means that there is a file on the storage that does not exist in the music collection.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>songmap</strong> – A list of tuple representing the external storage state.</li>
<li><strong>extconfig</strong> – Instance of the external storage configuration.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The updated songmap without the entries of the files that were removed in this method</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.SetMountpoint">
<code class="descname">SetMountpoint</code><span class="sig-paren">(</span><em>mountpoint='/mnt'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.SetMountpoint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.SetMountpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the mountpoint MusicDBExtern shall work on.
If the mountpoint does not exists, <code class="docutils literal"><span class="pre">False</span></code> gets returned.
The existence of a mountpoint does not guarantee that the device is mounted.
Furthermore the method does not check if the mounted device is initialized - this can be done by calling <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.IsStorageInitialized" title="mdbapi.extern.MusicDBExtern.IsStorageInitialized"><code class="xref py py-meth docutils literal"><span class="pre">IsStorageInitialized()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>mountpoint</strong> (<em>str</em>) – Path where the storage that shall be worked on is mounted</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><code class="docutils literal"><span class="pre">True</span></code> if <em>mountpoint</em> exists, <code class="docutils literal"><span class="pre">False</span></code> otherwise.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.UpdateSongmap">
<code class="descname">UpdateSongmap</code><span class="sig-paren">(</span><em>songmap</em>, <em>mdbpathlist</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.UpdateSongmap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.UpdateSongmap" title="Permalink to this definition">¶</a></dt>
<dd><p>This method updates the songmap read with <a class="reference internal" href="#mdbapi.extern.MusicDBExtern.ReadSongmap" title="mdbapi.extern.MusicDBExtern.ReadSongmap"><code class="xref py py-meth docutils literal"><span class="pre">ReadSongmap()</span></code></a>.
Therefore, new source-paths will be added, and old one will be removed.
The new ones will be tuple of <code class="docutils literal"><span class="pre">(srcpath,</span> <span class="pre">None)</span></code> added to the list.
Removing songs will be done by replacing the sourcepath with <code class="docutils literal"><span class="pre">None</span></code>.
This leads to a list of tuple, with each tuple representing one of the following states:</p>
<blockquote>
<div><ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">(srcp,</span> <span class="pre">dstp)</span></code> Nothing to do: Source and Destination files exists</li>
<li><code class="docutils literal"><span class="pre">(srcp,</span> <span class="pre">None)</span></code> New file in the collection that must be copied to the external storage</li>
<li><code class="docutils literal"><span class="pre">(None,</span> <span class="pre">dstp)</span></code> Old file on the storage that must be removed</li>
</ol>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>songmap</strong> – A list of tuples representing the external storage state. If <code class="docutils literal"><span class="pre">None</span></code>, an empty map will be created.</li>
<li><strong>mdbpathlist</strong> – list of relative paths representing the music colletion.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The updated songmap gets returned</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.UpdateStorage">
<code class="descname">UpdateStorage</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.UpdateStorage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.UpdateStorage" title="Permalink to this definition">¶</a></dt>
<dd><p>This method does the whole update process. It consists of the following steps:</p>
<ol class="arabic simple">
<li>Prepare envrionment like determin configfiles and opening them.</li>
<li>Get all song paths from the Music Database</li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.ReadSongmap" title="mdbapi.extern.MusicDBExtern.ReadSongmap"><code class="xref py py-meth docutils literal"><span class="pre">ReadSongmap()</span></code></a> - Read the current state of the external storage</li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.UpdateSongmap" title="mdbapi.extern.MusicDBExtern.UpdateSongmap"><code class="xref py py-meth docutils literal"><span class="pre">UpdateSongmap()</span></code></a> - Update the list with the current state of the music collection</li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.RemoveOldSongs" title="mdbapi.extern.MusicDBExtern.RemoveOldSongs"><code class="xref py py-meth docutils literal"><span class="pre">RemoveOldSongs()</span></code></a> - Remove old songs from the external storage that are no longer in the collection</li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.CopyNewSongs" title="mdbapi.extern.MusicDBExtern.CopyNewSongs"><code class="xref py py-meth docutils literal"><span class="pre">CopyNewSongs()</span></code></a> - Copy new songs from the collection to the storage. Here, transcoding will be applied if configured. See <a class="reference internal" href="#handling-toxic-environments">Handling Toxic Environments</a></li>
<li><a class="reference internal" href="#mdbapi.extern.MusicDBExtern.WriteSongmap" title="mdbapi.extern.MusicDBExtern.WriteSongmap"><code class="xref py py-meth docutils literal"><span class="pre">WriteSongmap()</span></code></a> - Writes the new state of the external storage device</li>
</ol>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><code class="docutils literal"><span class="pre">None</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mdbapi.extern.MusicDBExtern.WriteSongmap">
<code class="descname">WriteSongmap</code><span class="sig-paren">(</span><em>songmap</em>, <em>mappath</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mdbapi/extern.html#MusicDBExtern.WriteSongmap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mdbapi.extern.MusicDBExtern.WriteSongmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes all valid entries of <em>songmap</em> into the state-file.
This method generates the new state of the external storage.</p>
<p>A valid entry has a source and a destination path.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>songmap</strong> – A list of tuples representing the external storage state.</li>
<li><strong>mappath</strong> (<em>str</em>) – Path to the state-file</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal"><span class="pre">None</span></code></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Ralf Stemmer.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0 beta',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>