

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lib.db.musicdb &mdash; MusicDB 1.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="MusicDB 1.1.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> MusicDB
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/comparison.html">Comparison to Other Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/comparison.html#introducing-other-tools">Introducing other tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/comparison.html#metrics">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/comparison.html#comparison">Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/comparison.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/concept.html">Basic Rules for MusicDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/config.html">MusicDB Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#server">server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#websocket">websocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#tls">TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#database">database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#music">music</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#artwork">artwork</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#extern">extern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#tracker">tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#lycra">lycra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#mpd">MPD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#musicai">MusicAI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#randy">Randy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#log">log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/config.html#debug">debug</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/logging.html">Handling log-files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/mods.html">MusicDB Commandline Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/mods.html#loading-of-modules">Loading of Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/mods.html#creation-of-new-modules">Creation of new Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/testvm.html">MusicDB Test VMs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/testvm.html#qemu-installation">qemu Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/testvm.html#basic-setup">Basic Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/testvm.html#disk-images">Disk Images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/testvm.html#system-setup">System Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/testvm.html#installing-updating-musicdb-test-environment">Installing/Updating MusicDB Test Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/testvm.html#create-dummy-files">Create Dummy Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/testvm.html#test-systems">Test Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/testvm.html#debian">Debian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/testvm.html#raspian">Raspian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/testvm.html#arch-linux">Arch Linux</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/webapi.html">MusicDB Websocket API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/webapi.html#communication">Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#packet-format">Packet format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#methods">Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/webapi.html#client-side-interface">Client side interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#callback-functions">Callback functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#send-data-to-the-server">Send data to the server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/webapi.html#module-lib.ws.mdbwsi">Server side API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#artists">Artists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#albums">Albums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#songs">Songs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#queue">Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#tag-related">Tag related</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#lyrics">Lyrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/webapi.html#other">Other</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/workflow.html">Workflow for development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/workflow.html#working-on-code">Working on code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/workflow.html#rebuilding-the-documentation">Rebuilding the Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/workflow.html#using-git">Using git</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/workflow.html#micro-commits">Micro Commits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/workflow.html#createing-a-hotfix">Createing a Hotfix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basics/workflow.html#merging-develop-to-master">Merging Develop to Master</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/workflow.html#releasing-a-new-version">Releasing a New Version</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/install.html">Installation &amp; Update</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/install.html#installation-automatic">Installation (Automatic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#install-dependencies">Install Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#executing-the-install-sh-script">Executing the install.sh Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#install-all-dependencies">Install all Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#configureing-musicdb">Configureing MusicDB</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/install.html#installation-manually">Installation (Manually)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#system-preparation">System Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#id1">Install dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#basic-packages">Basic packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#mpd-music-player-daemon">MPD - Music Player Daemon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#apache-http-server">Apache HTTP-Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#download-musicdb">Download MusicDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#libprinthex">libprinthex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#id3edit">id3edit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/install.html#musicdb">musicdb</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/install.html#configureing-musicdb-webui">Configureing MusicDB WebUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/install.html#cuda-for-musicai">CUDA for MusicAI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/install.html#first-run">First Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/install.html#update">Update</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/music.html">Music</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/music.html#naming">Naming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/music.html#artist-directory">Artist Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/music.html#album-directory">Album Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/music.html#song-file">Song File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/music.html#importing-albums-to-the-collection">Importing Albums to the Collection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/music.html#itunes">iTunes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/music.html#bandcamp">Bandcamp</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/music.html#importing-albums-to-musicdb">Importing Albums to MusicDB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/music.html#using-the-database-module">Using the database module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usage/music.html#using-the-repair-module">Using the repair module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/music.html#updating-songs">Updating Songs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/scripts.html">Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/scripts.html#musicdb-boot">musicdb-boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/scripts.html#musicdb-shutdown">musicdb-shutdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/scripts.html#musicdb-start">musicdb-start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/scripts.html#musicdb-stop">musicdb-stop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/scripts.html#quickupdate">quickupdate</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">CLI Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/add.html">add - Add New Album to MusicDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/artwork.html">artwork - Artwork Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/artwork.html#class">class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/database.html">database - Music DB Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/extern.html">extern - Music File Uploader</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/extern.html#class">class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/extern.html#automatization">Automatization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/genres.html">genres - Genre Manager with CLUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/metadata.html">metadata - Metadata Reader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/mise.html">mise - Micro Search Engine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/mise.html#class">class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/moods.html">moods - Mood Tag Manager with CLUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/musicai.html">musicai - MusicAI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/musicai.html#module-mod.musicai">Module Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/musicai.html#class-description">Class Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/repair.html">repair - Repair Database Entries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/server.html">server - MusicDB Websocket Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/stats.html">stats - MusicDB Song Statistic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/tags.html">tags - MusicDB Tag Manager</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/tags.html#main-commands">Main commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/tags.html#style-guide">Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/tags.html#example-calls">Example calls</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mod/tracker.html">tracker - Song Tracker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/tracker.html#module-mod.tracker">Module Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mod/tracker.html#class-description">Class Description</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/artwork.html">Artwork Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/artwork.html#database">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/artwork.html#path-structure">Path structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../mdbapi/artwork.html#webbrowsers">Webbrowsers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/artwork.html#scaling">Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/artwork.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/artwork.html#manifest">Manifest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/artwork.html#algorithm">Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/artwork.html#musicdbartwork-class">MusicDBArtwork Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/artwork.html#module-lib.cache">ArtworkCache Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/database.html">MusicDBDatabase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/database.html#musicdbdatabase-class">MusicDBDatabase Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/extern.html">MusicDBExtern</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/extern.html#initializing-a-storage">Initializing a Storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../mdbapi/extern.html#storage-configuration">Storage Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../mdbapi/extern.html#the-state-file">The State-File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/extern.html#updating-a-storage">Updating a Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/extern.html#handling-toxic-environments">Handling Toxic Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/extern.html#musicdbextern-class">MusicDBExtern Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/lycra.html">LyCra - Lyrics Crawler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/lycra.html#module-mdbapi.lycra">Lycra API Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/lycra.html#crawler-base-class">Crawler Base Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/lycra.html#module-lib.db.lycradb">Lycra Database</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/mise.html">Micro Search Engine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/mise.html#musicdbmicrosearchengine-class">MusicDBMicroSearchEngine Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/mpd.html">mpd / Music Playing Daemon Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/mpd.html#interface">Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/mpd.html#observer-thread">Observer Thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/mpd.html#callbacks">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/mpd.html#managing-mpd">Managing MPD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/mpd.html#queue-management">Queue management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/musicai.html">MusicAI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/musicai.html#external-dependencies">External Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/musicai.html#training-time">Training Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/musicai.html#removing-an-old-model">Removing an old model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/musicai.html#data-handling">Data Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../mdbapi/musicai.html#featureset">Featureset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../mdbapi/musicai.html#trainingset">Trainingset</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/musicai.html#module-mdbapi.musicai">MusicAI Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/musicai.html#musicai-class">MusicAI Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/randy.html">Randomizer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/randy.html#module-mdbapi.randy">Randy Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/randy.html#randyinterface-class">RandyInterface Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/server.html">MusicDB Websocket Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/tags.html">MusicDBTags</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/tags.html#musicdbtags-class">MusicDBTags Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mdbapi/tracker.html">Song Tracker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/tracker.html#trackerinterface-class">TrackerInterface Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/tracker.html#module-lib.db.trackerdb">Tracker Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mdbapi/tracker.html#trackerdatabase-class">TrackerDatabase Class</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/clui.html">Command Line User Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.text">Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.frame">Frame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.pane">Pane</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.buttonview">ButtonView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.listview">ListView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.dialog">Dialog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.textinput">TextInput</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.boolinput">BoolInput</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/clui.html#module-lib.clui.tabgroup">TabGroup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/config.html#module-lib.cfg.config">Base Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/config.html#musicdb-configuration">MusicDB Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/config.html#module-lib.cfg.extern">External Storage Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/config.html#module-lib.cfg.mdbstate">MusicDB State</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/database.html">Database</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/database.html#database-class">Database Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/filesystem.html">Filesystem Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/filesystem.html#filesystem-class">Filesystem Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/hdf5storage.html">HDF5Storage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/hdf5storage.html#hdf5storage-class">HDF5Storage Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/metatags.html">Meta Tags</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/metatags.html#metatags-class">MetaTags Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/musicdb.html">MusicDatabase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/musicdb.html#adding-a-column">Adding a Column</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/musicdb.html#songs">Songs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/musicdb.html#albums">Albums</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../lib/musicdb.html#album-related-methods">Album Related Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lib/musicdb.html#artworks">Artworks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lib/musicdb.html#origin">Origin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/musicdb.html#artists">Artists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/musicdb.html#lyrics">Lyrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/musicdb.html#tags">Tags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../lib/musicdb.html#tag-definition-table">Tag Definition Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lib/musicdb.html#tag-mapping-table">Tag Mapping Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lib/musicdb.html#database-api">Database API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/musicdb.html#musicdatabase-class">MusicDatabase Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/pidfile.html">PID File Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../lib/websockets.html">MusicDB Websocket Protocol</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/websockets.html#module-lib.ws.server">Websocket Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lib/websockets.html#module-lib.ws.websocket">Websocket Protocol</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">JaveScript Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../webui/taginput.html">Tag Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../webui/taginput.html#taginput-js">taginput.js</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../webui/taginput.html#files">Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../webui/taginput.html#musicdb-interface">MusicDB Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../webui/taginput.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../webui/taginput.html#tagmanager-js">tagmanager.js</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../webui/taginput.html#id1">Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../webui/taginput.html#id2">MusicDB Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../webui/taginput.html#id3">Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../webui/websockets.html">Websocket Connection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../webui/websockets.html#connection-process">Connection Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../webui/websockets.html#watchdog">Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../webui/websockets.html#communication-with-the-server">Communication with the server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../webui/websockets.html#sending-data">Sending Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../webui/websockets.html#receiving-data">Receiving Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../webui/websockets.html#minimal-usage">Minimal usage</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../other/impressum.html">Impressum</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#angaben-gemasz-5-tmg">Angaben gemäß § 5 TMG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#kontakt">Kontakt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#verantwortlich-fur-den-inhalt-nach-55-abs-2-rstv">Verantwortlich für den Inhalt nach § 55 Abs. 2 RStV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#haftung-fur-inhalte">Haftung für Inhalte</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#haftung-fur-links">Haftung für Links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#urheberrecht">Urheberrecht</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../other/impressum.html#datenschutzerklarung">Datenschutzerklärung</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#datenschutz">Datenschutz</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#cookies">Cookies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#server-log-files">Server-Log-Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#facebook-plugins-like-button">Facebook-Plugins (Like-Button)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#twitter">Twitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#google">Google+</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#youtube">YouTube</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#ssl-verschlusselung">SSL-Verschlüsselung</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../other/impressum.html#widerspruch-werbe-mails">Widerspruch Werbe-Mails</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MusicDB</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>lib.db.musicdb</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for lib.db.musicdb</h1><div class="highlight"><pre>
<span></span><span class="c1"># MusicDB,  a music manager with web-bases UI that focus on music.</span>
<span class="c1"># Copyright (C) 2017  Ralf Stemmer &lt;ralf.stemmer@gmx.net&gt;</span>
<span class="c1"># </span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1"># </span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1"># </span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This class manages the *MusicDB Database* the core of *MusicDB*.</span>
<span class="sd">It caches information from the filesystem and provides augmentation of those files.</span>
<span class="sd">This database handles the following components:</span>

<span class="sd">    * `Songs`_</span>
<span class="sd">    * `Albums`_</span>
<span class="sd">    * `Artists`_</span>
<span class="sd">    * `Artworks`_</span>
<span class="sd">    * `Lyrics`_</span>
<span class="sd">    * `Tags`_</span>

<span class="sd">All database entries (= rows) are handled as dictionaries.</span>
<span class="sd">The key of the dictionary corresponds to the column name of the database.</span>

<span class="sd">If an entry of this dictionary got changed directly, the following methods can be used to store the changes in the database.</span>
<span class="sd">This is not the recommended way because the content gets not checked.</span>
<span class="sd">The preferred way to change any data is using the related method described in the following sections.</span>

<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.WriteArtist`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.WriteAlbum`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.WriteSong`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.WriteTag`</span>

<span class="sd">Adding a Column</span>
<span class="sd">---------------</span>

<span class="sd">When a new column shall be added, the following steps are necessary.</span>

<span class="sd">    #. Kill the server: ``kill $( cat /srv/data/musicdb/musicdb.pid )``</span>
<span class="sd">    #. Backup the database: ``sqlite3 music.db .dump &gt; backup/music.db.bak``</span>
<span class="sd">    #. Update this file.</span>
<span class="sd">    #. Update the SQL file *sql/music.sql*</span>
<span class="sd">    #. Modify the database:</span>
<span class="sd">        #. Open: ``sqlite3 music.db``</span>
<span class="sd">        #. Add column. For example ``ALTER TABLE songs ADD COLUMN feature INTEGER DEFAULT 0;``</span>
<span class="sd">        #. Quit: ``.quit``</span>

<span class="sd">Furthermore be sure that all command line modules and API modules handle the new added column, and so new added feature correct.</span>
<span class="sd">For example, methods creating a new entry in the modified row may be adopted.</span>

<span class="sd">Songs</span>
<span class="sd">-----</span>

<span class="sd">The columns of the songs table are the following:</span>

<span class="sd">    +--------+---------+----------+------+------+</span>
<span class="sd">    | songid | albumid | artistid | name | path |</span>
<span class="sd">    +--------+---------+----------+------+------+</span>

<span class="sd">    +--------+----+----------+----------+---------+</span>
<span class="sd">    | number | cd | disabled | playtime | bitrate |</span>
<span class="sd">    +--------+----+----------+----------+---------+</span>
<span class="sd">    </span>
<span class="sd">    +-------+----------+--------+-------+----------+----------+----------+-------------+</span>
<span class="sd">    | likes | dislikes | qskips | qadds | qremoves | favorite | qrndadds | lyricsstate |</span>
<span class="sd">    +-------+----------+--------+-------+----------+----------+----------+-------------+</span>

<span class="sd">The following methods exist to handle song entries in the database:</span>

<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.AddSong`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.AddFullSong`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetSongById`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetSongByPath`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetSongsByArtistId`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetSongsByAlbumId`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAllSongs`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetSongs`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetRandomSong`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetSongIdsByAlbumIds`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.UpdateSongStatistic`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.RemoveSong`</span>


<span class="sd">Albums</span>
<span class="sd">------</span>

<span class="sd">Data structure:</span>

<span class="sd">    +---------+----------+------+------+------------+----------+--------+---------+</span>
<span class="sd">    | albumid | artistid | name | path | numofsongs | numofcds | origin | release |</span>
<span class="sd">    +---------+----------+------+------+------------+----------+--------+---------+</span>

<span class="sd">    +-------------+---------+---------+---------+</span>
<span class="sd">    | artworkpath | bgcolor | fgcolor | hlcolor |</span>
<span class="sd">    +-------------+---------+---------+---------+</span>

<span class="sd">Album Related Methods</span>
<span class="sd">^^^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.AddAlbum`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAlbumByPath`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAlbumById`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAllAlbums`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAlbumsByArtistId`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAlbums`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAllAlbumIds`</span>

<span class="sd">Artworks</span>
<span class="sd">^^^^^^^^</span>

<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.SetArtwork`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.SetArtworkColorByAlbumId`</span>

<span class="sd">Origin</span>
<span class="sd">^^^^^^</span>

<span class="sd">Valid values:</span>

<span class="sd">    * ``&quot;iTunes&quot;``</span>
<span class="sd">    * ``&quot;bandcamp&quot;``</span>
<span class="sd">    * ``&quot;music163&quot;`` aka 网易云音乐</span>
<span class="sd">    * ``&quot;CD&quot;`` as fallback for unknown *flac* files</span>
<span class="sd">    * ``&quot;internet&quot;`` as fallback for any other unknown files</span>

<span class="sd">Artists</span>
<span class="sd">-------</span>

<span class="sd">Database structure:</span>

<span class="sd">        +----------+------+------+</span>
<span class="sd">        | artistid | name | path |</span>
<span class="sd">        +----------+------+------+</span>

<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.AddArtist`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAllArtists`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetArtistByPath`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetArtistById`</span>

<span class="sd">Lyrics</span>
<span class="sd">------</span>

<span class="sd">Lyrics state is part of the *songs* table.</span>
<span class="sd">The lyrics itself are stored in the *lyrics* table with the following layout:</span>

<span class="sd">    +--------+--------+</span>
<span class="sd">    | songid | lyrics |</span>
<span class="sd">    +--------+--------+</span>

<span class="sd">Lyrics are stored in a simple markup language:</span>

<span class="sd">    * ``:: ref`` starts a section for the refrain</span>
<span class="sd">    * ``:: comment`` starts a section for comments that are not part of the lyrics</span>
<span class="sd">    * ``::`` ends a section</span>
<span class="sd">    * ``&lt;&lt;…&gt;&gt;`` &quot;highlight&quot; text - use secondary color for printing this text</span>

<span class="sd">A lyrics entry could look like the following example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        :: comment</span>
<span class="sd">        Just a dummy text</span>
<span class="sd">        ::</span>

<span class="sd">        Lorem ipsum dolor sit amet, </span>
<span class="sd">        consetetur sadipscing elitr, </span>
<span class="sd">        sed diam nonumy eirmod tempor </span>
<span class="sd">        invidunt ut labore et dolore </span>
<span class="sd">        magna aliquyam erat, </span>
<span class="sd">        sed diam voluptua. </span>
<span class="sd">        </span>
<span class="sd">        :: ref</span>
<span class="sd">        At vero eos et accusam et justo duo dolores et ea rebum. </span>
<span class="sd">        Stet clita kasd gubergren, </span>
<span class="sd">        no sea takimata sanctus est Lorem ipsum dolor sit amet. </span>
<span class="sd">        ::</span>

<span class="sd">        &lt;&lt; (5 times) &gt;&gt;</span>

<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetLyrics`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.SetLyrics`</span>

<span class="sd">The *lyrics* column can have the following states:</span>

<span class="sd">    * ``SONG_LYRICSSTATE_EMPTY`` - There are no lyrics set yet</span>
<span class="sd">    * ``SONG_LYRICSSTATE_FROMFILE`` - The lyrics set come from the metatags of the song file</span>
<span class="sd">    * ``SONG_LYRICSSTATE_FROMNET`` - The lyrics were grabbed from the internet by a crawler</span>
<span class="sd">    * ``SONG_LYRICSSTATE_FROMUSER`` - The lyrics were reviewed by the user. This noted the highest state of quality for lyrics.</span>
<span class="sd">    * ``SONG_LYRICSSTATE_NONE`` - There are no lyrics for this song - it is an instrumental song.</span>

<span class="sd">Tags</span>
<span class="sd">----</span>

<span class="sd">In this section, the tag management is described.</span>
<span class="sd">A *Toxi* scheme is used to implement the tag system in MusicDB.</span>
<span class="sd">This means there are n+2 tables: </span>

<span class="sd">   #. A Table with the definition of a tag, </span>
<span class="sd">   #. a table that maps the tag to an entity, </span>
<span class="sd">   #. and *n* tables with entities with a global unique identifier.</span>

<span class="sd">MusicDB does not have global unique identifier for artists, albums an genres, so instead of one mapping table, there are two.</span>
<span class="sd">One for the songs, and one for the albums.</span>
<span class="sd">Tags for Artists are not expected.</span>
<span class="sd">If there will be a need later on, it an easy be implemented by adding a third mapping table and/or introducing new classes of tags.</span>
<span class="sd">A tag must be identifiable by the combination of its name and class.</span>

<span class="sd">Tag Definition Table</span>
<span class="sd">^^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">    +-------+------+-------+----------+----------+------+-------+------+------+</span>
<span class="sd">    | 0     | 1    | 2     | 3        | 4        | 5    | 6     | 7    | 8    |</span>
<span class="sd">    +-------+------+-------+----------+----------+------+-------+------+------+</span>
<span class="sd">    | TagID | Name | Class | ParentID | IconType | Icon | Color | PosX | PosY |</span>
<span class="sd">    +-------+------+-------+----------+----------+------+-------+------+------+</span>

<span class="sd">TagID (Integer)</span>
<span class="sd">   ID of the tag that gets generated by the database</span>

<span class="sd">Name (String)</span>
<span class="sd">   Name of the tag. It will be used inside the MusicDB code or by the UI as it is stored in the database.</span>
<span class="sd">   So, the name is set as it shall be displayed.</span>
<span class="sd">   It must also be a unique name inside its class.</span>

<span class="sd">Class (Integer)</span>
<span class="sd">   ID of the class:</span>
<span class="sd">  </span>
<span class="sd">   * ``1`` - Genre</span>
<span class="sd">   * ``2`` - Subgenre</span>
<span class="sd">   * ``3`` - Mood</span>

<span class="sd">ParentID (Integer / None)</span>
<span class="sd">   ID of a related tag. In case of subgenre, the main genres ID would be the ParentID.</span>
<span class="sd">   **Important:** A parent tag must always be of class *Genre*. And only *Subgenre* can and must have a parent!</span>

<span class="sd">IconType (Integer / None)</span>
<span class="sd">   If ``None`` the icon-column will be ignored. Otherwise it defines the type of icon:</span>

<span class="sd">   * ``1`` - Unicode character</span>
<span class="sd">   * ``2`` - HTML tag for special fonts: ``&lt;i class=&quot;fa fa-beer&quot;&gt;&lt;/i&gt;``</span>
<span class="sd">   * ``3`` - png image **Future feature - specification incomplete**</span>
<span class="sd">   * ``4`` - svg image **Future feature - specification incomplete**</span>

<span class="sd">Icon (Text / None)</span>
<span class="sd">   A shorter version of the name. The Icon must be compatible to the specified type.</span>

<span class="sd">Color (Text / None)</span>
<span class="sd">   A HTML-like color code that can be used to highlight a very special tag. Do not use this feature too much, it can break the UI visual design.</span>

<span class="sd">PosX, PosY (Integer / None)</span>
<span class="sd">   The (X;Y) Position of the Name or the Icon in a grid if the tags were presented as grid in an UI.</span>
<span class="sd">   The tag position gets stored in the global database to make sure that every UI provides a similar layout of the tags to make it more usable.</span>
<span class="sd">   ``(0;0)`` is the upper left corner.</span>
<span class="sd">   If not a grid but a list gets described, ``posx`` determines the position and ``posy`` is set to ``NULL``.</span>


<span class="sd">Tag Mapping Table</span>
<span class="sd">^^^^^^^^^^^^^^^^^</span>

<span class="sd">The mapping-tables have all the same layout</span>

<span class="sd">    +----------+----------+----------+------------+----------+</span>
<span class="sd">    | 0        | 1        | 2        | 3          | 4        |</span>
<span class="sd">    +----------+----------+----------+------------+----------+</span>
<span class="sd">    | EntryID  | SongID   | TagID    | Confidence | Approval |</span>
<span class="sd">    +----------+----------+----------+------------+----------+</span>
<span class="sd">    | EntryID  | AlbumID  | TagID    | Confidence | Approval |</span>
<span class="sd">    +----------+----------+----------+------------+----------+</span>

<span class="sd">EntryID (Integer)</span>
<span class="sd">   ID of the entry in the mapping-table</span>

<span class="sd">TagID (Integer)</span>
<span class="sd">   ID of the tag in the Tag-Definition-Table</span>

<span class="sd">xxxID (Integer)</span>
<span class="sd">   ID of the song or album entry in the related tables</span>

<span class="sd">Confidence (Floating point, Default: 1.0)</span>
<span class="sd">   Confidence that the tag is correct.</span>
<span class="sd">   This is important in case an AI set the tag (See *Approval*).</span>
<span class="sd">   Otherwise this column can be ignored. - Ignoring means setting it to ``1.0``!</span>
<span class="sd">   </span>
<span class="sd">Approval (Integer, Default: 1)</span>
<span class="sd">   Three stages to approve the tag.</span>

<span class="sd">   * ``0`` - Set by AI. This tag may be wrong. The *Confidence* value is relevant in this case.</span>
<span class="sd">   * ``1`` - Set by the User. *Confidence* must be set to ``1.0``</span>
<span class="sd">   * ``2`` - Can be used for training. This Song/Album is a good representation for this tag. It can be used to train an AI.</span>


<span class="sd">Database API</span>
<span class="sd">^^^^^^^^^^^^^</span>

<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.CreateTag`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetAllTags`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetTagByName`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.DeleteTag`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.ModifyTag`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.SetTargetTag`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.RemoveTargetTag`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.GetTargetTags`</span>
<span class="sd">    * :meth:`~lib.db.musicdb.MusicDatabase.SplitTagsByClass`</span>

<span class="sd">The following tag classes exist:</span>

<span class="sd">    * ``MusicDatabase.TAG_CLASS_GENRE``: Main genres like Metal, Electro, Classic, …</span>
<span class="sd">    * ``MusicDatabase.TAG_CLASS_SUBGENRE``: Subgenre like Dark Metal, New Wave, …</span>
<span class="sd">    * ``MusicDatabase.TAG_CLASS_MOOD``: Moods like Lucky, Sad, …</span>

<span class="sd">A target can be &quot;song&quot; or &quot;album&quot;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">lib.db.database</span> <span class="k">import</span> <span class="n">Database</span>

<span class="n">SONG_LYRICSSTATE_EMPTY</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">SONG_LYRICSSTATE_FROMFILE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">SONG_LYRICSSTATE_FROMNET</span>  <span class="o">=</span> <span class="mi">2</span>
<span class="n">SONG_LYRICSSTATE_FROMUSER</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">SONG_LYRICSSTATE_NONE</span>     <span class="o">=</span> <span class="mi">4</span> <span class="c1"># for instrumental songs</span>

<span class="n">MusicDatabaseLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span> <span class="c1"># RLock is mandatory for nested calles!</span>

<div class="viewcode-block" id="MusicDatabase"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase">[docs]</a><span class="k">class</span> <span class="nc">MusicDatabase</span><span class="p">(</span><span class="n">Database</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is the interface to the Music Database.</span>
<span class="sd">    It is derived from :class:`lib.db.database.Database`.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: path to the music database</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ARTIST_ID</span>     <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ARTIST_NAME</span>   <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ARTIST_PATH</span>   <span class="o">=</span> <span class="mi">2</span>

    <span class="n">ALBUM_ID</span>         <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ALBUM_ARTISTID</span>   <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ALBUM_NAME</span>       <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ALBUM_PATH</span>       <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ALBUM_NUMOFSONGS</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">ALBUM_NUMOFCDS</span>   <span class="o">=</span> <span class="mi">5</span>
    <span class="n">ALBUM_ORIGIN</span>     <span class="o">=</span> <span class="mi">6</span> <span class="c1"># iTunes, Netz, CD</span>
    <span class="n">ALBUM_RELEASE</span>    <span class="o">=</span> <span class="mi">7</span>
    <span class="n">ALBUM_ARTWORKPATH</span><span class="o">=</span> <span class="mi">8</span>
    <span class="n">ALBUM_BGCOLOR</span>    <span class="o">=</span> <span class="mi">9</span>
    <span class="n">ALBUM_FGCOLOR</span>    <span class="o">=</span> <span class="mi">10</span>
    <span class="n">ALBUM_HLCOLOR</span>    <span class="o">=</span> <span class="mi">11</span>

    <span class="n">SONG_ID</span>         <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SONG_ALBUMID</span>    <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SONG_ARTISTID</span>   <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SONG_NAME</span>       <span class="o">=</span> <span class="mi">3</span>
    <span class="n">SONG_PATH</span>       <span class="o">=</span> <span class="mi">4</span>
    <span class="n">SONG_NUMBER</span>     <span class="o">=</span> <span class="mi">5</span>
    <span class="n">SONG_CD</span>         <span class="o">=</span> <span class="mi">6</span>
    <span class="n">SONG_DISABLED</span>   <span class="o">=</span> <span class="mi">7</span>
    <span class="n">SONG_PLAYTIME</span>   <span class="o">=</span> <span class="mi">8</span>
    <span class="n">SONG_BITRATE</span>    <span class="o">=</span> <span class="mi">9</span>
    <span class="n">SONG_LIKES</span>      <span class="o">=</span> <span class="mi">10</span>
    <span class="n">SONG_DISLIKES</span>   <span class="o">=</span> <span class="mi">11</span>
    <span class="n">SONG_QSKIPS</span>     <span class="o">=</span> <span class="mi">12</span>
    <span class="n">SONG_QADDS</span>      <span class="o">=</span> <span class="mi">13</span>
    <span class="n">SONG_QREMOVES</span>   <span class="o">=</span> <span class="mi">14</span>
    <span class="n">SONG_FAVORITE</span>   <span class="o">=</span> <span class="mi">15</span>
    <span class="n">SONG_QRNDADDS</span>   <span class="o">=</span> <span class="mi">16</span>
    <span class="n">SONG_LYRICSSTATE</span> <span class="o">=</span> <span class="mi">17</span>
    <span class="c1"># Q* : Queue statistics</span>

    <span class="n">ARTWORK_ID</span>               <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ARTWORK_ALBUMID</span>          <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ARTWORK_PATH</span>             <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ARTWORK_COLOR_BACKGROUND</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ARTWORK_COLOR_FOREGROUND</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">ARTWORK_COLOR_HIGHLIGHT</span>  <span class="o">=</span> <span class="mi">5</span>

    <span class="n">TAG_ID</span>          <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TAG_NAME</span>        <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TAG_CLASS</span>       <span class="o">=</span> <span class="mi">2</span>
    <span class="n">TAG_CLASS_GENRE</span>         <span class="o">=</span> <span class="mi">1</span> <span class="c1"># genre-tags (metal, electro, …)</span>
    <span class="n">TAG_CLASS_SUBGENRE</span>      <span class="o">=</span> <span class="mi">2</span> <span class="c1"># subgenre (dark metal, …)</span>
    <span class="n">TAG_CLASS_MOOD</span>          <span class="o">=</span> <span class="mi">3</span> <span class="c1"># moods (lucky, sad, …)</span>
    <span class="n">TAG_PARENTID</span>    <span class="o">=</span> <span class="mi">3</span>
    <span class="n">TAG_ICONTYPE</span>    <span class="o">=</span> <span class="mi">4</span>
    <span class="n">TAG_ICONTYPE_UNICODE</span>    <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TAG_ICONTYPE_HTML</span>       <span class="o">=</span> <span class="mi">2</span>
    <span class="n">TAG_ICON</span>        <span class="o">=</span> <span class="mi">5</span>
    <span class="n">TAG_COLOR</span>       <span class="o">=</span> <span class="mi">6</span>
    <span class="n">TAG_POSX</span>        <span class="o">=</span> <span class="mi">7</span>
    <span class="n">TAG_POSY</span>        <span class="o">=</span> <span class="mi">8</span>

    <span class="c1"># For albumtags and songtags table</span>
    <span class="n">TAGMAP_ENTRYID</span>      <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TAGMAP_TARGETID</span>     <span class="o">=</span> <span class="mi">1</span> <span class="c1"># can be SongID or AlbumID, depening on the map</span>
    <span class="n">TAGMAP_TAGID</span>        <span class="o">=</span> <span class="mi">2</span>
    <span class="n">TAGMAP_CONFIDENCE</span>   <span class="o">=</span> <span class="mi">3</span>
    <span class="n">TAGMAP_APPROVAL</span>     <span class="o">=</span> <span class="mi">4</span>

    <span class="n">LYRIC_SONGID</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LYRIC_LYRIC</span>  <span class="o">=</span> <span class="mi">1</span>

    <span class="n">SUBGENRE_ID</span>         <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SUBGENRE_NAME</span>       <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SUBGENRE_MAINGENRE</span>  <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">Database</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">__ArtistEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="n">artist</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">artist</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTIST_ID</span><span class="p">]</span>
        <span class="n">artist</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTIST_NAME</span><span class="p">]</span>
        <span class="n">artist</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTIST_PATH</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">artist</span>
        
    <span class="k">def</span> <span class="nf">__AlbumEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="n">album</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_ID</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;artistid&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_ARTISTID</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_NAME</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_PATH</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;numofsongs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_NUMOFSONGS</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;numofcds&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_NUMOFCDS</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_ORIGIN</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;release&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_RELEASE</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;artworkpath&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_ARTWORKPATH</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;bgcolor&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_BGCOLOR</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;fgcolor&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_FGCOLOR</span><span class="p">]</span>
        <span class="n">album</span><span class="p">[</span><span class="s2">&quot;hlcolor&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_HLCOLOR</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">album</span>

    <span class="k">def</span> <span class="nf">__SongEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="n">song</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_ID</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;albumid&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_ALBUMID</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;artistid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_ARTISTID</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_NAME</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_PATH</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_NUMBER</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;cd&quot;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_CD</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;disabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_DISABLED</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;playtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_PLAYTIME</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;bitrate&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_BITRATE</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;likes&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_LIKES</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;dislikes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_DISLIKES</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;qskips&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_QSKIPS</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;qadds&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_QADDS</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;qremoves&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_QREMOVES</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;favorite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_FAVORITE</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;qrndadds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_QRNDADDS</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;lyricsstate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SONG_LYRICSSTATE</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">song</span>

    <span class="k">def</span> <span class="nf">__ArtworkEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="n">song</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTWORK_ID</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;albumid&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTWORK_ALBUMID</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTWORK_PATH</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;bgcolor&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTWORK_COLOR_BACKGROUND</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;fgcolor&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTWORK_COLOR_FOREGROUND</span><span class="p">]</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;hlcolor&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARTWORK_COLOR_HIGHLIGHT</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">song</span>

    <span class="k">def</span> <span class="nf">__TagEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_ID</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;parentid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_PARENTID</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;icontype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_ICONTYPE</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;icon&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_ICON</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_COLOR</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;posx&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_POSX</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;posy&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_POSY</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tag</span>

    <span class="k">def</span> <span class="nf">__AlbumTagEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__TagMapToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;albumid&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__SongTagEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__TagMapToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;songid&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__TagMapEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">targetidname</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;entryid&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAGMAP_ENTRYID</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="n">targetidname</span><span class="p">]</span>   <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAGMAP_TARGETID</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;tagid&quot;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAGMAP_TAGID</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAGMAP_CONFIDENCE</span><span class="p">]</span>
        <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;approval&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAGMAP_APPROVAL</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tag</span>

    <span class="k">def</span> <span class="nf">__SubgenreEntryToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="n">subgenre</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">subgenre</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBGENRE_ID</span><span class="p">]</span>
        <span class="n">subgenre</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBGENRE_NAME</span><span class="p">]</span>
        <span class="n">subgenre</span><span class="p">[</span><span class="s2">&quot;maingenre&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SUBGENRE_MAINGENRE</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">subgenre</span> 


<div class="viewcode-block" id="MusicDatabase.WriteArtist"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.WriteArtist">[docs]</a>    <span class="k">def</span> <span class="nf">WriteArtist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the whole row for an artist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        UPDATE artists SET</span>
<span class="s2">            name=:name,</span>
<span class="s2">            path=:path</span>
<span class="s2">        WHERE</span>
<span class="s2">            artistid=:id</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">artist</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MusicDatabase.WriteAlbum"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.WriteAlbum">[docs]</a>    <span class="k">def</span> <span class="nf">WriteAlbum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">album</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the whole row for an album.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        UPDATE albums SET</span>
<span class="s2">            artistid=:artistid,</span>
<span class="s2">            name=:name,</span>
<span class="s2">            path=:path,</span>
<span class="s2">            numofsongs=:numofsongs,</span>
<span class="s2">            numofcds=:numofcds,</span>
<span class="s2">            origin=:origin,</span>
<span class="s2">            release=:release,</span>
<span class="s2">            artworkpath=:artworkpath,</span>
<span class="s2">            bgcolor=:bgcolor,</span>
<span class="s2">            fgcolor=:fgcolor,</span>
<span class="s2">            hlcolor=:hlcolor</span>
<span class="s2">        WHERE</span>
<span class="s2">            albumid=:id</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">album</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MusicDatabase.WriteSong"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.WriteSong">[docs]</a>    <span class="k">def</span> <span class="nf">WriteSong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">song</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the whole row for a song.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        UPDATE songs SET</span>
<span class="s2">            albumid=:albumid,</span>
<span class="s2">            artistid=:artistid,</span>
<span class="s2">            name=:name,</span>
<span class="s2">            path=:path,</span>
<span class="s2">            number=:number,</span>
<span class="s2">            cd=:cd,</span>
<span class="s2">            disabled=:disabled,</span>
<span class="s2">            playtime=:playtime,</span>
<span class="s2">            bitrate=:bitrate,</span>
<span class="s2">            likes=:likes,</span>
<span class="s2">            dislikes=:dislikes,</span>
<span class="s2">            qskips=:qskips,</span>
<span class="s2">            qadds=:qadds,</span>
<span class="s2">            qremoves=:qremoves,</span>
<span class="s2">            favorite=:favorite,</span>
<span class="s2">            qrndadds=:qrndadds,</span>
<span class="s2">            lyricsstate=:lyricsstate</span>
<span class="s2">        WHERE</span>
<span class="s2">            songid=:id</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">song</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MusicDatabase.WriteTag"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.WriteTag">[docs]</a>    <span class="k">def</span> <span class="nf">WriteTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the whole row for a tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        UPDATE tags SET</span>
<span class="s2">            name=:name,</span>
<span class="s2">            class=:class,</span>
<span class="s2">            parentid=:parentid,</span>
<span class="s2">            icontype=:icontype,</span>
<span class="s2">            icon=:icon,</span>
<span class="s2">            color=:color,</span>
<span class="s2">            posx=:posx,</span>
<span class="s2">            posy=:posy</span>
<span class="s2">        WHERE</span>
<span class="s2">            tagid=:id</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>



    <span class="c1">##########################################################################</span>
    <span class="c1"># ARTISTS                                                                #</span>
    <span class="c1">##########################################################################</span>


<div class="viewcode-block" id="MusicDatabase.AddArtist"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.AddArtist">[docs]</a>    <span class="k">def</span> <span class="nf">AddArtist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new artist into the artists table</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the artist</span>
<span class="sd">            path (str): relative path of the artist directory</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *path* is not of type ``str``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check arguments</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Path must have a string-value!&quot;</span><span class="p">)</span>

        <span class="c1"># create new entry</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO artists (name, path) VALUES ( ?, ?)&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="MusicDatabase.GetAllArtists"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAllArtists">[docs]</a>    <span class="k">def</span> <span class="nf">GetAllArtists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all artists in the artists table.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of all artists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM artists&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

        <span class="n">artists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">artist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ArtistEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

            <span class="n">artists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">artists</span></div>



<div class="viewcode-block" id="MusicDatabase.GetArtistByPath"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetArtistByPath">[docs]</a>    <span class="k">def</span> <span class="nf">GetArtistByPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the artist by the relative path of the music directory.</span>
<span class="sd">        This is usually only a directroy name.</span>

<span class="sd">        Args:</span>
<span class="sd">            parth (str): relative path of an artist</span>

<span class="sd">        Returns:</span>
<span class="sd">            The database entry of the artist or ``None`` if there is no entry for this artist directory</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *path* is not a string</span>
<span class="sd">            AssertionError: When there is no artist with the given path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Path must have a string-value!&quot;</span><span class="p">)</span>

        <span class="c1"># check if this artist exists</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM artists WHERE path = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="c1"># check result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple Artist entries for one directory in database!&quot;</span><span class="p">)</span>

        <span class="n">entry</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># remove the list thing, now it&#39;s just a tuple</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ArtistEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div>


<div class="viewcode-block" id="MusicDatabase.GetArtistById"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetArtistById">[docs]</a>    <span class="k">def</span> <span class="nf">GetArtistById</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artistid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the artist by its ID</span>

<span class="sd">        Args:</span>
<span class="sd">            artistid: ID of the artist in the artist table</span>

<span class="sd">        Returns:</span>
<span class="sd">            The database entry of the artist or ``None`` if there is no entry for this artist directory</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *artistid* is not an integer or a string</span>
<span class="sd">            ValueError: When *artistid* is a string that cannot be interpreted as a decimal number</span>
<span class="sd">            AssertionError: When there is more than one entry with the same ID (This should never happen)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">artistid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ArtistID must be a decimal number!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ArtistID must be of type int or str and is a decimal number!&quot;</span><span class="p">)</span>

        <span class="c1"># check if this artist exists</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM artists WHERE artistid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">artistid</span><span class="p">)</span>

        <span class="c1"># check result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple Artist entries for one ID in database!&quot;</span><span class="p">)</span>

        <span class="n">entry</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># remove the list thing, now it&#39;s just a tuple</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ArtistEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div>




    <span class="c1">##########################################################################</span>
    <span class="c1"># ALBUMS                                                                 #</span>
    <span class="c1">##########################################################################</span>


<div class="viewcode-block" id="MusicDatabase.AddAlbum"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.AddAlbum">[docs]</a>    <span class="k">def</span> <span class="nf">AddAlbum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artistid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new entry for an album.</span>

<span class="sd">        Args:</span>
<span class="sd">            artistid: ID of the artist who is related to the album</span>
<span class="sd">            name (str): name of album</span>
<span class="sd">            path (str): relative path of the album</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *path* or *name* is not of type string, and *artistid* not a string or an integer</span>
<span class="sd">            ValueError: When *artistid* is not a decimal number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Path must have a string-value!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Name must have a string-value!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">artistid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ArtistID must be a decimal number!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ArtistID must be of type int or str and is a decimal number!&quot;</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">artistid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO albums (artistid, name, path) VALUES (?, ?, ?)&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="MusicDatabase.GetAlbumByPath"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAlbumByPath">[docs]</a>    <span class="k">def</span> <span class="nf">GetAlbumByPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an album entry if available</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): relative path of an album</span>

<span class="sd">        Returns:</span>
<span class="sd">            An album entry or ``None`` it the album does not exits</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *path* is not of type ``str``</span>
<span class="sd">            AssertionError: If there is more than one album with the given path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Path must have a string-value!&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM albums WHERE path = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="c1"># check result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple Album entries for one directory in the database!&quot;</span><span class="p">)</span>

        <span class="n">entry</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__AlbumEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div>


    <span class="c1"># Get album by its id otherwise None</span>
<div class="viewcode-block" id="MusicDatabase.GetAlbumById"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAlbumById">[docs]</a>    <span class="k">def</span> <span class="nf">GetAlbumById</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">albumid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an album entry if available</span>

<span class="sd">        Args:</span>
<span class="sd">            albumid: entry ID of the album in the album table</span>

<span class="sd">        Returns:</span>
<span class="sd">            An album entry or ``None`` it the album does not exits</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *albumid* is not set</span>
<span class="sd">            AssertionError: If there is more than one album with the given ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">albumid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">albumid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;AlbumID must have a decimal value!&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM albums WHERE albumid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">albumid</span><span class="p">)</span>

        <span class="c1"># check result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple Album entries for one ID in the database!&quot;</span><span class="p">)</span>

        <span class="n">entry</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__AlbumEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div>


<div class="viewcode-block" id="MusicDatabase.GetAllAlbums"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAllAlbums">[docs]</a>    <span class="k">def</span> <span class="nf">GetAllAlbums</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See :meth:`~lib.db.musicdb.MusicDatabase.GetAlbums` (``GetAlbums(artistid=None, withsongs=False``)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetAlbums</span><span class="p">()</span></div>

<div class="viewcode-block" id="MusicDatabase.GetAlbumsByArtistId"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAlbumsByArtistId">[docs]</a>    <span class="k">def</span> <span class="nf">GetAlbumsByArtistId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artistid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See :meth:`~lib.db.musicdb.MusicDatabase.GetAlbums` (``GetAlbums(artistid, withsongs=False``)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetAlbums</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span></div>

    <span class="c1"># returns a list with all artists. Each list element is a dictionary with all columns of the database</span>
<div class="viewcode-block" id="MusicDatabase.GetAlbums"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAlbums">[docs]</a>    <span class="k">def</span> <span class="nf">GetAlbums</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artistid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">withsongs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list with all albums in the database, or all albums of an artist if *artistid* is not ``None``.</span>
<span class="sd">        If the *withsongs* parameter is ``True``, for each album all songs will be included.</span>
<span class="sd">        They are added as list into each album entry under the key ``songs``</span>

<span class="sd">        Example:</span>

<span class="sd">            The following example prints all songs of the artist with the ID ``1000``</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                albums = musicdb.GetAlbums(artistid = 1000, withsongs = True)</span>
<span class="sd">                for album in albums:</span>
<span class="sd">                    for song in album[&quot;songs&quot;]:</span>
<span class="sd">                        print(song[&quot;name&quot;])</span>

<span class="sd">        Args:</span>
<span class="sd">            artistid: ID for an artist whose albums shall be returned. If ``None`` the albums get not filtered by *artistid*.</span>
<span class="sd">            withsongs (bool): also return all songs of the album.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list with all albums.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *withsongs* is not of type ``bool``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">withsongs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;WithSongs must have a boolean value!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">artistid</span><span class="p">:</span>
            <span class="n">sql</span>   <span class="o">=</span> <span class="s2">&quot;SELECT * FROM albums WHERE artistid = ?&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sql</span>   <span class="o">=</span> <span class="s2">&quot;SELECT * FROM albums&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="n">albums</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">album</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__AlbumEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">withsongs</span><span class="p">:</span>
                    <span class="n">album</span><span class="p">[</span><span class="s2">&quot;songs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongs</span><span class="p">(</span><span class="n">album</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

                <span class="n">albums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">album</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">albums</span></div>


<div class="viewcode-block" id="MusicDatabase.GetAllAlbumIds"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAllAlbumIds">[docs]</a>    <span class="k">def</span> <span class="nf">GetAllAlbumIds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            Returns a list of all album IDs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT albumid FROM albums&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">albumids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">albumids</span><span class="p">]</span> <span class="c1"># do not use tuples</span>
        <span class="k">return</span> <span class="n">retval</span></div>


    <span class="c1">#------------------------------------------------------------------------#</span>
    <span class="c1"># ARTWORK                                                                #</span>
    <span class="c1">#------------------------------------------------------------------------#</span>


<div class="viewcode-block" id="MusicDatabase.SetArtwork"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.SetArtwork">[docs]</a>    <span class="k">def</span> <span class="nf">SetArtwork</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">albumid</span><span class="p">,</span> <span class="n">artworkpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the *artworkpath* entry of the MusicDB Database for an album.</span>

<span class="sd">        Args:</span>
<span class="sd">            albumid: ID of the album that artwork path shall be updated</span>
<span class="sd">            artworkpath (str): New relative artwork path for the album</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *albumid* is not an integer or a string</span>
<span class="sd">            TypeError: If *artworkpath* is not of type ``str``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">albumid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">albumid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;AlbumID must have a decimal number of type string or integer!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">artworkpath</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ArtworkName must have a value of type string!&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE albums SET artworkpath = ? WHERE albumid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">artworkpath</span><span class="p">,</span> <span class="n">albumid</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="MusicDatabase.SetArtworkColorByAlbumId"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.SetArtworkColorByAlbumId">[docs]</a>    <span class="k">def</span> <span class="nf">SetArtworkColorByAlbumId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">albumid</span><span class="p">,</span> <span class="n">colorname</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is for setting a color for an album.</span>
<span class="sd">        Valid color names are the following and must be given as string to the *colorname* parameter.</span>

<span class="sd">        * ``&quot;bgcolor&quot;`` -  Background color</span>
<span class="sd">        * ``&quot;fgcolor&quot;`` -  Primary foreground color</span>
<span class="sd">        * ``&quot;hlcolor&quot;`` -  Secondary foreground color</span>

<span class="sd">        The color itself must be in HTML-Format: ``#RRGGBB``.</span>

<span class="sd">        Args:</span>
<span class="sd">            albumid: The ID of the album that color shall be set</span>
<span class="sd">            colorname (str): Name of the color that shall be set</span>
<span class="sd">            color (str): Color in HTML format</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If one of the arguments is None</span>
<span class="sd">            ValueError: If *colorname* not ``&quot;bgcolor&quot;``, ``&quot;fgcolor&quot;`` or ``&quot;hlcolor&quot;``</span>
<span class="sd">            ValueError: If color length is not ``7`` and first character not ``&quot;#&quot;``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">albumid</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">color</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">colorname</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All parameters must have a value!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">colorname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bgcolor&quot;</span><span class="p">,</span> <span class="s2">&quot;fgcolor&quot;</span><span class="p">,</span> <span class="s2">&quot;hlcolor&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;colorname must be bgcolor, fgcolor or hlcolor&quot;</span><span class="p">);</span>

        <span class="k">if</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First char in color-code must be </span><span class="se">\&#39;</span><span class="s2">#</span><span class="se">\&#39;</span><span class="s2">: #RRGGBB !&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Color-code must have a length of 7 character: #RRGGBB !&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">color</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;albumid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">albumid</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE albums SET &quot;</span> <span class="o">+</span> <span class="n">colorname</span> <span class="o">+</span> <span class="s2">&quot;=:color WHERE albumid=:albumid&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>



    <span class="c1">##########################################################################</span>
    <span class="c1"># SONGS                                                                  #</span>
    <span class="c1">##########################################################################</span>


<div class="viewcode-block" id="MusicDatabase.AddSong"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.AddSong">[docs]</a>    <span class="k">def</span> <span class="nf">AddSong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artistid</span><span class="p">,</span> <span class="n">albumid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a new database entry for a song and sets the most important values.</span>

<span class="sd">        If a song with the same path is already in the database, its *artistid*, *albumid* and *name* gets compared to the arguments.</span>
<span class="sd">        If they match, everything is fine and the method returns.</span>
<span class="sd">        If they differ, an AssertionError gets raised.</span>
<span class="sd">        Adding an existing song is a bug!</span>
<span class="sd">        Even if this method allows it under some conditions, this should not be exploited!</span>

<span class="sd">        Args:</span>
<span class="sd">            artistid (int): ID of the artist of this song</span>
<span class="sd">            albumid (int): ID of the album of this song</span>
<span class="sd">            name (string): Name of the song</span>
<span class="sd">            path (string): Path of the song file relative to the music root directory</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If one of the arguments is ``None``</span>
<span class="sd">            ValueError: If song is already in the database **and** does not match the other parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">artistid</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">albumid</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">path</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All parameters must have a value!&quot;</span><span class="p">)</span>

        <span class="c1"># Check if song already exists</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">song</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongByPath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">song</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;artistid&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">artistid</span> <span class="ow">or</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;albumid&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">albumid</span> <span class="ow">or</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There is a song with the same path already exists in the database but with other attributes!&quot;</span><span class="p">)</span>

                <span class="c1"># even if it works, adding an already existing song is a bug. Inform the programmer/user</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Song with path </span><span class="si">%s</span><span class="s2"> does already exist in database. </span><span class="se">\033</span><span class="s2">[1;30m(It matches the artist ID and album ID so everything is fine right now)&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO songs (albumid, artistid, name, path) VALUES (?, ?, ?, ?)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">albumid</span><span class="p">,</span> <span class="n">artistid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="MusicDatabase.AddFullSong"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.AddFullSong">[docs]</a>    <span class="k">def</span> <span class="nf">AddFullSong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">song</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a new entry for a song and adds all its attributes into the database.</span>
<span class="sd">        Creating the song is done by calling :meth:`~lib.db.musicdb.MusicDatabase.AddSong`.</span>
<span class="sd">        When the song was added a new song ID is generated by the database engine.</span>
<span class="sd">        The new entry gets read from the database.</span>
<span class="sd">        Then, the new ID is set as song ID to the dictionary given as argument.</span>
<span class="sd">        After that, the whole song dictionary gest written to the database via :meth:`~lib.db.musicdb.MusicDatabase.WriteSong`</span>

<span class="sd">        In case adding the song fails on half the way, the new added entry gets deleted.</span>
<span class="sd">        As long as nothing references the song entry, it is no problem to remove it.</span>
<span class="sd">        So, when this method returns ``False`` Nothing changed in the database.</span>

<span class="sd">        Args:</span>
<span class="sd">            song: A complete dictionary with all keys of a MusicDB Song entry for the database</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``True`` on success, otherwise ``False`` which indicates that nothing changed in the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AddSong</span><span class="p">(</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;artistid&quot;</span><span class="p">],</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;albumid&quot;</span><span class="p">],</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongByPath</span><span class="p">(</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
                <span class="n">song</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">WriteSong</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;The following Exception occured: </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">. Trying to delete the half added song </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> from database as long as this is save.&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="p">)</span>
            
                <span class="c1"># At this point, it is better to only rely on the path</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM songs WHERE path = ?&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>
        

<div class="viewcode-block" id="MusicDatabase.GetSongById"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetSongById">[docs]</a>    <span class="k">def</span> <span class="nf">GetSongById</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">songid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a song from the database that matches the *songid*</span>

<span class="sd">        Args:</span>
<span class="sd">            songid (int): ID of the song that shall be returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            A MusicDB Song dictionary or ``None`` if there is no song with that ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *songid* is not an integer or a string</span>
<span class="sd">            AssertionError: If there is more than one song with the same ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;SongID must be a decimal number of type integer or string!&quot;</span><span class="p">)</span>

        <span class="n">sql</span>    <span class="o">=</span> <span class="s2">&quot;SELECT * FROM songs WHERE songid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">songid</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple Song entries for one ID in the database!&quot;</span><span class="p">)</span>

        <span class="n">song</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SongEntryToDict</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">song</span></div>


<div class="viewcode-block" id="MusicDatabase.GetSongByPath"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetSongByPath">[docs]</a>    <span class="k">def</span> <span class="nf">GetSongByPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a song from the database that matches the *path*</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): A song path relative to the music root directory</span>

<span class="sd">        Returns:</span>
<span class="sd">            A MusicDB Song dictionary or ``None`` if there is no song with that path</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *path* is ``None``</span>
<span class="sd">            AssertionError: If there is more than one song with the same path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Path must have a value of type string!&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM songs WHERE path = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="c1"># check result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple Song entries for one path in the database! (&quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>

        <span class="n">entry</span>  <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SongEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div>


<div class="viewcode-block" id="MusicDatabase.GetSongsByArtistId"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetSongsByArtistId">[docs]</a>    <span class="k">def</span> <span class="nf">GetSongsByArtistId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artistid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns all song entries of an Artist.</span>

<span class="sd">        Args:</span>
<span class="sd">            artistid (int): ID of an artist</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of MusicDB Songs</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If artistid is not a decimal number of type integer or sting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">artistid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Artist ID must have be a decimal number of type integer or string!&quot;</span><span class="p">)</span>

        <span class="n">sql</span>    <span class="o">=</span> <span class="s2">&quot;SELECT * FROM songs WHERE artistid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">artistid</span><span class="p">)</span>

        <span class="n">songs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">song</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">song</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SongEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">songs</span></div>


<div class="viewcode-block" id="MusicDatabase.GetSongsByAlbumId"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetSongsByAlbumId">[docs]</a>    <span class="k">def</span> <span class="nf">GetSongsByAlbumId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">albumid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See :meth:`~lib.db.musicdb.MusicDatabase.GetSongs`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongs</span><span class="p">(</span><span class="n">albumid</span><span class="p">)</span></div>

<div class="viewcode-block" id="MusicDatabase.GetAllSongs"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAllSongs">[docs]</a>    <span class="k">def</span> <span class="nf">GetAllSongs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See :meth:`~lib.db.musicdb.MusicDatabase.GetSongs`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongs</span><span class="p">()</span></div>

<div class="viewcode-block" id="MusicDatabase.GetSongs"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetSongs">[docs]</a>    <span class="k">def</span> <span class="nf">GetSongs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">albumid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns all songs in the database if *albumid* is ``None``, or all songs of an album if *albumid* is set.</span>

<span class="sd">        Args:</span>
<span class="sd">            albumid (int): ID of an album or ``None``</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of MusicDB Songs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">albumid</span><span class="p">:</span>
            <span class="n">sql</span>   <span class="o">=</span> <span class="s2">&quot;SELECT * FROM songs WHERE albumid = ?&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">albumid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sql</span>   <span class="o">=</span> <span class="s2">&quot;SELECT * FROM songs&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">songs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">song</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">song</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SongEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">songs</span></div>


<div class="viewcode-block" id="MusicDatabase.GetRandomSong"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetRandomSong">[docs]</a>    <span class="k">def</span> <span class="nf">GetRandomSong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterlist</span><span class="o">=</span><span class="p">[],</span> <span class="n">nodisabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nohated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">minlen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a random song that fulfills several constraints.</span>

<span class="sd">        The *filterlist* can be either a set of genre tag IDs or a set of genre names.</span>

<span class="sd">        Filtering is done by the following steps:</span>

<span class="sd">            #. Get album IDs of all albums in the database</span>
<span class="sd">            #. Translate *filterlist* into a list of tag IDs</span>
<span class="sd">            #. For each album, get its tags and compare that with the set of tag IDs from the filter. (If there is no filter list set, all album IDs are selected)</span>
<span class="sd">            #. Get all song IDs that are related to the filtered album IDs by calling :meth:`~lib.db.musicdb.MusicDatabase.GetSongIdsByAlbumIds`</span>
<span class="sd">            #. Select a random song ID and get its song entry from the database</span>

<span class="sd">        Args:</span>
<span class="sd">            filterlist: Optional, default value is ``[]``. A list of genre names or genre tag IDs that limits the search set. The tags have *OR* relations.</span>
<span class="sd">            nodisabled (bool): If ``True`` no disables songs will be selected</span>
<span class="sd">            nohated (bool): If ``True`` no hated songs will be selected</span>
<span class="sd">            minlen (int): If set, no songs with less than *minlen* seconds will be selected</span>

<span class="sd">        Returns:</span>
<span class="sd">            A random MusicDB Song dictionary that fulfills the constraints,</span>
<span class="sd">            or ``None`` when there is no song fulfilling the constraints</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *nodisabled* or *nohated* are not of type ``bool``</span>
<span class="sd">            TypeError: When *minlen* is not ``None`` and not of type integer</span>
<span class="sd">            TypeError: When *filterlist* is not a list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nodisabled</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;nodisabled must be of type bool&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nohated</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;nohated must be of type bool&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">minlen</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">minlen</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;minlen must be None or of type integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filterlist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;filterlist must be of type list&quot;</span><span class="p">)</span>


        <span class="c1"># Create a list of tagids that limits the set of albums</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">tagids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filterlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">filterentry</span> <span class="ow">in</span> <span class="n">filterlist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filterentry</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                        <span class="n">tag</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTagByName</span><span class="p">(</span><span class="n">filterentry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">)</span>
                        <span class="n">tagid</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tagid</span> <span class="o">=</span> <span class="n">filterentry</span>

                    <span class="n">tagids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tagid</span><span class="p">)</span>

            <span class="c1"># create a set from the list to compare it with a set of albumtags</span>
            <span class="n">tagids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tagids</span><span class="p">)</span>

            <span class="c1"># Get IDs of all albums existing in the database</span>
            <span class="n">sql</span>      <span class="o">=</span> <span class="s2">&quot;SELECT albumid FROM albums&quot;</span>
            <span class="n">retval</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">albumids</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALBUM_ID</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">retval</span><span class="p">]</span>

            <span class="c1"># Only select albums that have a tag listed in the tagids list</span>
            <span class="n">selectedalbumids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tagids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">albumid</span> <span class="ow">in</span> <span class="n">albumids</span><span class="p">:</span>
                    <span class="c1"># Get tags of the album</span>
                    <span class="n">albumtags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTargetTags</span><span class="p">(</span><span class="s2">&quot;album&quot;</span><span class="p">,</span> <span class="n">albumid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">albumtags</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># Check if one tag matches the filter</span>
                    <span class="n">albumtagids</span> <span class="o">=</span> <span class="p">{</span> <span class="n">albumtag</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">albumtag</span> <span class="ow">in</span> <span class="n">albumtags</span> <span class="p">}</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">tagids</span> <span class="o">&amp;</span> <span class="n">albumtagids</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">selectedalbumids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">albumid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selectedalbumids</span> <span class="o">=</span> <span class="n">albumids</span>

            <span class="c1"># Get all Songs that may be candidate</span>
            <span class="n">songids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongIdsByAlbumIds</span><span class="p">(</span><span class="n">selectedalbumids</span><span class="p">,</span> <span class="n">nodisabled</span><span class="p">,</span> <span class="n">nohated</span><span class="p">,</span> <span class="n">minlen</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">songids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Choose a random one</span>
        <span class="n">songid</span>   <span class="o">=</span> <span class="n">songids</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">songids</span><span class="p">))]</span>
        <span class="n">song</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongById</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">song</span></div>


<div class="viewcode-block" id="MusicDatabase.GetSongIdsByAlbumIds"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetSongIdsByAlbumIds">[docs]</a>    <span class="k">def</span> <span class="nf">GetSongIdsByAlbumIds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">albumids</span><span class="p">,</span> <span class="n">nodisabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nohated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">minlen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of songs that belong to the albums addressed by their IDs in the *albumids* list.</span>
<span class="sd">        The songs of the returned IDs also fulfill the constraints given by the other parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            albumids: A list of album IDs that songs are considered to get</span>
<span class="sd">            nodisabled (bool): If ``True`` no disables songs will be selected</span>
<span class="sd">            nohated (bool): If ``True`` no hated songs will be selected</span>
<span class="sd">            minlen (int): If set, no songs with less than *minlen* seconds will be selected</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of song IDs</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *nodisabled* or *nohated* are not of type ``bool``</span>
<span class="sd">            TypeError: When *minlen* is not ``None`` and not of type integer</span>
<span class="sd">            ValueError: When minlen is less than ``0``</span>
<span class="sd">            TypeError: When *albumuids* is ``None``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nodisabled</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;nodisabled must be of type bool&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nohated</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;nohated must be of type bool&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">minlen</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">minlen</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;minlen must be None or of type integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">albumids</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;albumids must have a value!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">albumids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">albumids</span> <span class="o">=</span> <span class="p">[</span><span class="n">albumids</span><span class="p">]</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT songid FROM songs WHERE albumid = ?&quot;</span>
        <span class="k">if</span> <span class="n">nodisabled</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; AND disabled != 1&quot;</span>
        <span class="k">if</span> <span class="n">nohated</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; AND favorite &gt;= 0&quot;</span>
        <span class="k">if</span> <span class="n">minlen</span><span class="p">:</span>
            <span class="c1"># make sure the argument does not mess up te query-string</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">minlen</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">minlen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;minlen must be &gt;= 0&quot;</span><span class="p">)</span>
            <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; AND playtime &gt;= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">minlen</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">songids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">albumid</span> <span class="ow">in</span> <span class="n">albumids</span><span class="p">:</span>
                <span class="c1"># returns a list of tuples with one element: [(id1,), .., (idn,)]</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">albumid</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">songids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">songids</span></div>



<div class="viewcode-block" id="MusicDatabase.GetLyrics"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetLyrics">[docs]</a>    <span class="k">def</span> <span class="nf">GetLyrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">songid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the lyrics of a song.</span>

<span class="sd">        Args:</span>
<span class="sd">            songid (int): ID of the song for that the lyrics shall be returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            The lyrics of a song or ``None`` if there are no lyrics for the song.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *sonid* is not an integer or string</span>
<span class="sd">            AssertionError: If there were multiple lyrics entries for the given song ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;songid must be a decimal number of type integer or string&quot;</span><span class="p">)</span>

        <span class="n">sql</span>    <span class="o">=</span> <span class="s2">&quot;SELECT lyrics FROM lyrics WHERE songid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">songid</span><span class="p">))</span>

        <span class="c1"># check result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple lyrics entries for one songid in the database! (&quot;</span> <span class="o">+</span> <span class="n">songid</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>

        <span class="n">lyrics</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># list -&gt; tuple</span>
        <span class="n">lyrics</span> <span class="o">=</span> <span class="n">lyrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># tuple-&gt; string</span>
        <span class="k">return</span> <span class="n">lyrics</span></div>



<div class="viewcode-block" id="MusicDatabase.SetLyrics"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.SetLyrics">[docs]</a>    <span class="k">def</span> <span class="nf">SetLyrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">songid</span><span class="p">,</span> <span class="n">lyrics</span><span class="p">,</span> <span class="n">lyricsstate</span><span class="o">=</span><span class="n">SONG_LYRICSSTATE_FROMUSER</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method can be used to store or to update lyrics of a song.</span>
<span class="sd">        It stores the lyrics in the lyrics table and updates the lyrics state in the songs table for a given song.</span>

<span class="sd">        If there are no lyrics for the song, or lyrics shall be removed, the lyrics argument must be ``None`` or ``&quot;&quot;``.</span>
<span class="sd">        In this case the lyrics state gets forced to ``SONG_LYRICSSTATE_EMPTY``.</span>
<span class="sd">        Only excepetion is, when the *lyricsstate* is ``SONG_LYRICSSTATE_NONE`` which indicates that the song does not have lyrics at all.</span>
<span class="sd">        For example, instrumental songs or intros.</span>

<span class="sd">        Args:</span>
<span class="sd">            songid (int): ID of the song the lyrics belong to</span>
<span class="sd">            lyrics (str): The lyrics to store</span>
<span class="sd">            lyricsstate (int): The new state of the lyrics. Default is &quot;From User&quot; (``SONG_LYRICSSTATE_FROMUSER``)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Always ``True``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *sonid* is not an integer or string</span>
<span class="sd">            TypeError: If lyrics state is not a number.</span>
<span class="sd">            ValueError: If lyrics state is not in ``SONG_LYRICSSTATE_*``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;songid must be a decimal number of type integer or string&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">lyricsstate</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lyricsstate</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;lyricsstate is not an integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lyricsstate</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">SONG_LYRICSSTATE_EMPTY</span><span class="p">,</span> <span class="n">SONG_LYRICSSTATE_FROMFILE</span><span class="p">,</span> <span class="n">SONG_LYRICSSTATE_FROMNET</span><span class="p">,</span> <span class="n">SONG_LYRICSSTATE_FROMUSER</span><span class="p">,</span> <span class="n">SONG_LYRICSSTATE_NONE</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lyricsstate has an invalid value: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lyricsstate</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; See documentation for valid values!&quot;</span><span class="p">)</span>

        <span class="c1"># make sure the states are clear</span>
        <span class="k">if</span> <span class="n">lyrics</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">lyrics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># If it is not an instrumental song, the entry is just empty</span>
        <span class="k">if</span> <span class="n">lyrics</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lyricsstate</span> <span class="o">!=</span> <span class="n">SONG_LYRICSSTATE_NONE</span><span class="p">:</span>
            <span class="n">lyricsstate</span> <span class="o">=</span> <span class="n">SONG_LYRICSSTATE_EMPTY</span>

        <span class="k">if</span> <span class="n">lyricsstate</span> <span class="ow">in</span> <span class="p">[</span><span class="n">SONG_LYRICSSTATE_EMPTY</span><span class="p">,</span> <span class="n">SONG_LYRICSSTATE_NONE</span><span class="p">]:</span>
            <span class="n">lyrics</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># try to get old lyrics to see if there exists an entry already</span>
        <span class="n">sql</span>    <span class="o">=</span> <span class="s2">&quot;SELECT lyrics FROM lyrics WHERE songid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">songid</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple lyrics entries for one songid in the database! (&quot;</span> <span class="o">+</span> <span class="n">songid</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lyrics</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># delete existing lyrics entry</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM lyrics WHERE songid = ?&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">songid</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">result</span><span class="p">:</span>
                <span class="c1"># update existing entry</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE lyrics SET lyrics = ? WHERE songid = ?&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">lyrics</span><span class="p">,</span> <span class="n">songid</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># create new entry</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO lyrics (songid, lyrics) VALUES (?, ?)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">songid</span><span class="p">,</span> <span class="n">lyrics</span><span class="p">))</span>

            <span class="c1"># Set Lyricsstate</span>
            <span class="n">song</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongById</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span>
            <span class="n">song</span><span class="p">[</span><span class="s2">&quot;lyricsstate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lyricsstate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">WriteSong</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="MusicDatabase.UpdateSongStatistic"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.UpdateSongStatistic">[docs]</a>    <span class="k">def</span> <span class="nf">UpdateSongStatistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">songid</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the song statistics.</span>

<span class="sd">        Statistics are: ``&quot;likes&quot;``, ``&quot;dislikes&quot;``, ``&quot;qskips&quot;``, ``&quot;qadds&quot;``, ``&quot;qrndadds&quot;``, ``&quot;qremoves&quot;``, ``&quot;favorite&quot;``, ``&quot;disabled&quot;``</span>

<span class="sd">        Values are:</span>
<span class="sd">            </span>
<span class="sd">            * ``&quot;inc&quot;``, ``&quot;love&quot;``, ``&quot;yes&quot;``: Increment value</span>
<span class="sd">            * ``&quot;dec&quot;``, ``&quot;hate&quot;``: Decrement value</span>
<span class="sd">            * ``&quot;reset&quot;``, ``&quot;none&quot;``, ``&quot;no&quot;``: Set value to ``0``</span>

<span class="sd">        Args:</span>
<span class="sd">            songid (int): ID of the song</span>
<span class="sd">            stat (str): Name of the statistics to update</span>
<span class="sd">            value (str): How to update</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *songid* is not an integer or string</span>
<span class="sd">            ValueError: if stats or value have an invalid value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;songid must be a decimal number of type integer or string&quot;</span><span class="p">)</span>

        <span class="c1"># Check if value and stat are valid</span>
        <span class="k">if</span> <span class="n">stat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;likes&quot;</span><span class="p">,</span> <span class="s2">&quot;dislikes&quot;</span><span class="p">,</span> <span class="s2">&quot;qskips&quot;</span><span class="p">,</span> <span class="s2">&quot;qadds&quot;</span><span class="p">,</span> <span class="s2">&quot;qrndadds&quot;</span><span class="p">,</span> <span class="s2">&quot;qremoves&quot;</span><span class="p">,</span> <span class="s2">&quot;favorite&quot;</span><span class="p">,</span> <span class="s2">&quot;disable&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;stat has an invalid value </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;inc&quot;</span><span class="p">,</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="s2">&quot;love&quot;</span><span class="p">,</span> <span class="s2">&quot;hate&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value has an invalid value </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="c1"># Get song entry</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">song</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSongById</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span>

            <span class="c1"># generate modifier</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;inc&quot;</span><span class="p">,</span> <span class="s2">&quot;love&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">]:</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;hate&quot;</span><span class="p">]:</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">]:</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># apply modifier</span>
            <span class="k">if</span> <span class="n">stat</span> <span class="o">==</span> <span class="s2">&quot;favorite&quot;</span><span class="p">:</span>
                <span class="n">song</span><span class="p">[</span><span class="s2">&quot;favorite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span>
            <span class="k">elif</span> <span class="n">stat</span> <span class="o">==</span> <span class="s2">&quot;disable&quot;</span><span class="p">:</span>
                <span class="n">song</span><span class="p">[</span><span class="s2">&quot;disabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modifier</span>
            <span class="k">elif</span> <span class="n">modifier</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">song</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span>       <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">song</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span>      <span class="o">+=</span> <span class="n">modifier</span>

            <span class="c1"># Write Song</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">WriteSong</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="MusicDatabase.RemoveSong"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.RemoveSong">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveSong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">songid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method removes a song entry and all related data from all tables.</span>

<span class="sd">        The removed data are:</span>

<span class="sd">            * The complete row in the songs-table for this song</span>
<span class="sd">            * The lyrics of this song</span>
<span class="sd">            * All tags of this song (not the tag definition)</span>
<span class="sd">            * Decrementation of the albums *numofsongs* value. (not the *numofcds* entry!)</span>

<span class="sd">        Args:</span>
<span class="sd">            songid (int): ID of the song</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When *songid* is not an integer or string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">songid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;songid must be a decimal number of type integer or string&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM songs WHERE songid = ?&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">songid</span><span class="p">)</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM lyrics WHERE songid = ?&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">songid</span><span class="p">)</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM songtags WHERE songid = ?&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">songid</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1">####################################</span>
    <span class="c1"># TAG HANDLING</span>
    <span class="c1">####################################</span>

<div class="viewcode-block" id="MusicDatabase.GetAllTags"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetAllTags">[docs]</a>    <span class="k">def</span> <span class="nf">GetAllTags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of tags from the tags table.</span>
<span class="sd">        If *tagclass* is set, only tags of the specified class gets returned.</span>
<span class="sd">        Otherwise all tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            tagclass (int): Optional, to only get tags of the given class</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tags</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If *tagclass* is set (not ``None``) with an invalid value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tagclass</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sql</span>     <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tags&quot;</span>
                <span class="n">taglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tagclass</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_MOOD</span><span class="p">]:</span>
                <span class="n">sql</span>     <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tags WHERE class = ?&quot;</span>
                <span class="n">taglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tagclass must be None or a valid Integer.&quot;</span><span class="p">)</span>

        <span class="n">retval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tagentry</span> <span class="ow">in</span> <span class="n">taglist</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__TagEntryToDict</span><span class="p">(</span><span class="n">tagentry</span><span class="p">)</span>
            <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">retval</span></div>



<div class="viewcode-block" id="MusicDatabase.CreateTag"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.CreateTag">[docs]</a>    <span class="k">def</span> <span class="nf">CreateTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">,</span> <span class="n">parentid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a new tag in the tags-table.</span>

<span class="sd">        If the tag already exists in its class, it will not be created.</span>

<span class="sd">        Args:</span>
<span class="sd">            tagname (str): Name of the new tag. This is also the name that gets displayed in the GUI.</span>
<span class="sd">            tagclass (int): Defines the class of the tag.</span>
<span class="sd">            parentid (int): Optional parent relation to other tags - Mandatory for subgenre</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: if *tagname* is not a string or *parentid* does not have the value it should have regarding the specification</span>
<span class="sd">            ValueError: When *tagclass* has an invalid value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Name must be of type string!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tagclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_MOOD</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid tag class&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tagclass</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span> <span class="ow">and</span> <span class="n">parentid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;When creating a subgenre, the parent ID must be given!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tagclass</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span> <span class="ow">and</span> <span class="n">parentid</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;When not creating a subgenre, the parent ID must be  None!&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTagByName</span><span class="p">(</span><span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Tag </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> (class=</span><span class="si">%i</span><span class="s2">) already exists!&quot;</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO tags (name, class, parentid) VALUES (?,?,?)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">,</span> <span class="n">parentid</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="MusicDatabase.DeleteTag"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.DeleteTag">[docs]</a>    <span class="k">def</span> <span class="nf">DeleteTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes an entry from the tags-table with the name *tagname* and that belongs to *tagclass*.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method does NOT delete child tags or the relation between the tag and songs or albums.</span>
<span class="sd">            You should only delete new created tags that are not used!</span>

<span class="sd">        Args:</span>
<span class="sd">            tagname (str):  Name of the tag that shall be deleted.</span>
<span class="sd">            tagclass (int): Class of the name the tag belongs to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *tagname* is not of type ``str`` </span>
<span class="sd">            ValueError: If *tagclass* is not a valid class ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Name must be of type string!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tagclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_MOOD</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid tag class&quot;</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Deleting tag </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> of class </span><span class="si">%i</span><span class="s2"> from tags-table!&quot;</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM tags WHERE name = ? AND class = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="MusicDatabase.ModifyTag"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.ModifyTag">[docs]</a>    <span class="k">def</span> <span class="nf">ModifyTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">,</span> <span class="n">columnname</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method allows to modify most of the attributes of a tag.</span>
<span class="sd">        The *tagname* and *tagclass* addresses the tag, *columnname* the attribute.</span>
<span class="sd">        *newvalue* is the new attribute set for the tag.</span>

<span class="sd">        In case the icon gets modified, take care that the icon type is up to date. (update order does not matter).</span>

<span class="sd">        Args:</span>
<span class="sd">            tagname (str): Name of the tag that shall be modified</span>
<span class="sd">            tagclass (int): Class of the tag</span>
<span class="sd">            columnname (str): The name of the attribute that shall be modified</span>
<span class="sd">            newvalue: The new value. Read the introduction at the top of the document to see what values are possible for a specific attribute</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: if *tagname* is not a string or *parentid* does not have the value it should have regarding the specification</span>
<span class="sd">            ValueError: When *tagclass* has an invalid value</span>
<span class="sd">            ValueError: If columnname is not &quot;name&quot;, &quot;parentid&quot;, &quot;icontype&quot;, &quot;icon&quot;, &quot;color&quot;, &quot;posx&quot;, &quot;posy&quot;</span>
<span class="sd">            ValueError: If columnname is &quot;color&quot; and *newvalue* is not a valid #RRGGBB-Formated string</span>
<span class="sd">            ValueError: If columnname is &quot;icontype&quot; and *newvalue* is not valid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Name must be of type string!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tagclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_MOOD</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid tag class&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">columnname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;parentid&quot;</span><span class="p">,</span> <span class="s2">&quot;icontype&quot;</span><span class="p">,</span> <span class="s2">&quot;icon&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;posx&quot;</span><span class="p">,</span> <span class="s2">&quot;posy&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid column name </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">!&quot;</span><span class="p">,</span> <span class="n">columnname</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">columnname</span> <span class="o">==</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First char in color-code must be </span><span class="se">\&#39;</span><span class="s2">#</span><span class="se">\&#39;</span><span class="s2">: #RRGGBB !&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newvalue</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Color-code must have a length of 7 character: #RRGGBB !&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">columnname</span> <span class="o">==</span> <span class="s2">&quot;icontype&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newvalue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_ICONTYPE_UNICODE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_ICONTYPE_HTML</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid icontype&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newvalue</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">tagname</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tagclass</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE tags SET &quot;</span> <span class="o">+</span> <span class="n">columnname</span> <span class="o">+</span> <span class="s2">&quot;=:value WHERE name=:name AND class=:class&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="MusicDatabase.SetTargetTag"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.SetTargetTag">[docs]</a>    <span class="k">def</span> <span class="nf">SetTargetTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">targetid</span><span class="p">,</span> <span class="n">tagid</span><span class="p">,</span> <span class="n">approval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sets a tag for a target. </span>
<span class="sd">        A target can be a song (``target = &quot;song&quot;``) or an album (``target = &quot;album&quot;``).</span>

<span class="sd">        The defaults for this method assume that the tag got set by a user.</span>

<span class="sd">            * If *approval* equals ``1`` or ``2``, the confidence gets set to ``1.0``.</span>
<span class="sd">            * If *approval* equals ``0`` a *confidence* must be given, otherwise an ``AssertionError`` gets thrown.</span>

<span class="sd">        If the tag was already set, the *approval* and *confidence* values get updated. </span>
<span class="sd">        But only if the new approval level is greater or equal to the already set one.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (str):   Target that shall be tagged (``&quot;song&quot;`` for a song, ``&quot;album&quot;`` for an album)</span>
<span class="sd">            songid (int):   ID of the target that shall be tagged. (a song ID or an album ID)</span>
<span class="sd">            tagid (int):    ID of the tag that shall be associated with the target</span>
<span class="sd">            approval (int): Approval of the association. Default is ``1`` - &quot;Set by User&quot;</span>
<span class="sd">            confidence (float): Confidence of the association in case *approval* is ``0`` - &quot;Set by AI&quot;</span>

<span class="sd">        Return:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *target* not in *{&quot;song&quot;, &quot;album&quot;}*</span>
<span class="sd">            TypeError: If ``approval == 0 and confidence == None``</span>
<span class="sd">            ValueError: If *approval* not in *{0,1,2}*</span>
<span class="sd">            ValueError: If ``songid == None or tagid == None``</span>
<span class="sd">            AssertionError: If there already exists more than one entry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">targetid</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tagid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;SongID and TagID must have a value!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">approval</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">approval</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">approval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">confidence</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;If approval is 0 (tagged by AI), the confidence must be given!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;approval must be element of {0,1,2}!&quot;</span><span class="p">)</span>

        <span class="c1"># select table</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;song&quot;</span><span class="p">:</span>
            <span class="n">tablename</span> <span class="o">=</span> <span class="s2">&quot;songtags&quot;</span>
            <span class="n">idname</span>    <span class="o">=</span> <span class="s2">&quot;songid&quot;</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;album&quot;</span><span class="p">:</span>
            <span class="n">tablename</span> <span class="o">=</span> <span class="s2">&quot;albumtags&quot;</span>
            <span class="n">idname</span>    <span class="o">=</span> <span class="s2">&quot;albumid&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;target must be </span><span class="se">\&quot;</span><span class="s2">song</span><span class="se">\&quot;</span><span class="s2"> or </span><span class="se">\&quot;</span><span class="s2">album</span><span class="se">\&quot;</span><span class="s2">!&quot;</span><span class="p">)</span>

        <span class="c1"># check if already tagged</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="s2">&quot; WHERE &quot;</span> <span class="o">+</span> <span class="n">idname</span> <span class="o">+</span> <span class="s2">&quot; = ? AND tagid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">targetid</span><span class="p">,</span> <span class="n">tagid</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;More that one tag entry found!&quot;</span><span class="p">)</span>

            <span class="c1"># only update an existing entry</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tag</span>  <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAGMAP_APPROVAL</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">approval</span><span class="p">:</span>
                    <span class="c1"># This can now happen very often due to the DeriveAlbumTags method.</span>
                    <span class="c1"># This is no longer a symptom of misbehavior.</span>
                    <span class="c1">#logging.warning(&quot;The tag was already set and has a higher approval level (%d) than the update (%d)! \033[1;30m(update gets rejected for %s %d)&quot;, tag[self.TAGMAP_APPROVAL], approval, target, targetid)</span>
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;entryid&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAGMAP_ENTRYID</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;approval&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">approval</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">confidence</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="s2">&quot; SET confidence=:confidence, approval=:approval WHERE entryid=:entryid&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="c1"># create new entry</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">idname</span> <span class="o">+</span> <span class="s2">&quot;, tagid, confidence, approval) VALUES (?, ?, ?, ?)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">targetid</span><span class="p">,</span> <span class="n">tagid</span><span class="p">,</span> <span class="n">confidence</span><span class="p">,</span> <span class="n">approval</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="MusicDatabase.RemoveTargetTag"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.RemoveTargetTag">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveTargetTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">targetid</span><span class="p">,</span> <span class="n">tagid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an association between a target and a tag in the tag map - Or short: Removes a tag from a song or an album.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (str):   Target that shall be tagged (``&quot;song&quot;`` for a song, ``&quot;album&quot;`` for an album)</span>
<span class="sd">            targetid (int): ID of the target that shall be tagged. (a song ID or an album ID)</span>
<span class="sd">            tagid (int):    ID of the tag that shall be associated with the target</span>

<span class="sd">        Return:</span>
<span class="sd">            ``None``</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If *target* not in *{&quot;song&quot;, &quot;album&quot;}*</span>
<span class="sd">            TypeError: If ``songid == None or tagid == None``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">targetid</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tagid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;SongID and TagID must have a value!&quot;</span><span class="p">)</span>

        <span class="c1"># select table</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;song&quot;</span><span class="p">:</span>
            <span class="n">tablename</span> <span class="o">=</span> <span class="s2">&quot;songtags&quot;</span>
            <span class="n">idname</span>    <span class="o">=</span> <span class="s2">&quot;songid&quot;</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;album&quot;</span><span class="p">:</span>
            <span class="n">tablename</span> <span class="o">=</span> <span class="s2">&quot;albumtags&quot;</span>
            <span class="n">idname</span>    <span class="o">=</span> <span class="s2">&quot;albumid&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;target must be </span><span class="se">\&quot;</span><span class="s2">song</span><span class="se">\&quot;</span><span class="s2"> or </span><span class="se">\&quot;</span><span class="s2">album</span><span class="se">\&quot;</span><span class="s2">!&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="s2">&quot; WHERE &quot;</span> <span class="o">+</span> <span class="n">idname</span> <span class="o">+</span> <span class="s2">&quot; = ? AND tagid = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">targetid</span><span class="p">,</span> <span class="n">tagid</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span></div>


    
<div class="viewcode-block" id="MusicDatabase.GetTargetTags"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetTargetTags">[docs]</a>    <span class="k">def</span> <span class="nf">GetTargetTags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">targetid</span><span class="p">,</span> <span class="n">tagclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all tags of a target.</span>
<span class="sd">        A target can be a song (``target = &quot;song&quot;``) or an album (``target = &quot;album&quot;``).</span>
<span class="sd">        This list contains all classes of tags if *tagclass* is ``None``, otherwise only of type *tagclass*.</span>

<span class="sd">        The returned list is the target-tag-mapping augmented with the tag-entry.</span>
<span class="sd">        So, each element in the list is a merged dictionary of the table row of the mapping and the tag itself.</span>
<span class="sd">        The ``id`` entry in the dictionary is the ID of the Tag and identical to the entry ``tagid``.</span>
<span class="sd">        The ID of the ID of the entry in the mapping-table is ``entryid``.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            target (str):   Target that shall be tagged (``&quot;song&quot;`` for a song, ``&quot;album&quot;`` for an album)</span>
<span class="sd">            targetid (int): ID of the target that tags shall be returned (song ID or album ID)</span>
<span class="sd">            tagclass (int): If not ``None`` only tags of a specific class will be returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tags or ``None`` if there are no tags</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If *songid* is ``None``</span>
<span class="sd">            ValueError: If *tagclass* is set to an invalid value (``None`` is valid)</span>
<span class="sd">            ValueError: If *target* not in *{&quot;song&quot;, &quot;album&quot;}*</span>

<span class="sd">        Example:</span>

<span class="sd">            .. code-block:: python</span>
<span class="sd">                </span>
<span class="sd">                tags = database.GetTargetTags(&quot;song&quot;, songid)</span>
<span class="sd">                for tag in tags:</span>
<span class="sd">                    print(&quot;Tagname: %s&quot;,  tag[&quot;name&quot;], end=&quot;; &quot;)</span>
<span class="sd">                    print(&quot;Approval: %i&quot;, tag[&quot;approval&quot;])</span>
<span class="sd">                    print(&quot;Approval: %f&quot;, tag[&quot;confidence&quot;])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">targetid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Target ID must have a value!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tagclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_MOOD</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid tag class&quot;</span><span class="p">)</span>

        <span class="c1"># select table</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;song&quot;</span><span class="p">:</span>
            <span class="n">tablename</span> <span class="o">=</span> <span class="s2">&quot;songtags&quot;</span>
            <span class="n">idname</span>    <span class="o">=</span> <span class="s2">&quot;songid&quot;</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;album&quot;</span><span class="p">:</span>
            <span class="n">tablename</span> <span class="o">=</span> <span class="s2">&quot;albumtags&quot;</span>
            <span class="n">idname</span>    <span class="o">=</span> <span class="s2">&quot;albumid&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;target must be </span><span class="se">\&quot;</span><span class="s2">song</span><span class="se">\&quot;</span><span class="s2"> or </span><span class="se">\&quot;</span><span class="s2">album</span><span class="se">\&quot;</span><span class="s2">!&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="c1"># get all tagids assigned to the target</span>
            <span class="n">sql</span>    <span class="o">=</span> <span class="s2">&quot;SELECT * FROM &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="s2">&quot; WHERE &quot;</span> <span class="o">+</span> <span class="n">idname</span> <span class="o">+</span> <span class="s2">&quot; = ?&quot;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">targetid</span><span class="p">)</span>

            <span class="c1"># returns a list of tuples with one element: [(id1,), .., (idn,)]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span> <span class="c1"># no tags set</span>

            <span class="c1"># for each tagid</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="c1"># Translate mapping </span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__TagMapEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">idname</span><span class="p">)</span>

                <span class="c1"># Get mapped tag</span>
                <span class="n">sql</span>      <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tags WHERE tagid = ?&quot;</span>
                <span class="n">tagentry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;tagid&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tagentry</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;33mUnknown tag ID &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;tagid&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; for &quot;</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s2">&quot; ID &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">songid</span><span class="p">))</span>
                    <span class="k">continue</span>

                <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__TagEntryToDict</span><span class="p">(</span><span class="n">tagentry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="c1"># Check if it shall be filtered</span>
                <span class="k">if</span> <span class="n">tagclass</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">tagclass</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Add tag-information to mapping</span>
                <span class="n">mapping</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">retval</span></div>



<div class="viewcode-block" id="MusicDatabase.SplitTagsByClass"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.SplitTagsByClass">[docs]</a>    <span class="k">def</span> <span class="nf">SplitTagsByClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits a list of tags into several lists, each of a specific class.</span>

<span class="sd">        If the *tags* parameter is ``None``, this method returns ``[]`` for each class.</span>

<span class="sd">        Args:</span>
<span class="sd">            tags (list): A list of tags</span>

<span class="sd">        Returns:</span>
<span class="sd">            three lists, each of a specific class: genres, subgenres, moods</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If a tag contains an invalid class ID</span>

<span class="sd">        Exampe:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                tags = database.GetTagretTags(&quot;song&quot;, songid)</span>
<span class="sd">                genres, subgenres, moods = database.SplitTagsByClass(tags)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">genres</span>    <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subgenres</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">moods</span>     <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">genres</span><span class="p">,</span> <span class="n">subgenres</span><span class="p">,</span> <span class="n">moods</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">:</span>
                <span class="n">genres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span><span class="p">:</span>
                <span class="n">subgenres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_MOOD</span><span class="p">:</span>
                <span class="n">moods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid class ID!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">genres</span><span class="p">,</span> <span class="n">subgenres</span><span class="p">,</span> <span class="n">moods</span></div>



<div class="viewcode-block" id="MusicDatabase.GetTagByName"><a class="viewcode-back" href="../../../lib/musicdb.html#lib.db.musicdb.MusicDatabase.GetTagByName">[docs]</a>    <span class="k">def</span> <span class="nf">GetTagByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="o">=</span><span class="n">TAG_CLASS_GENRE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a tag entry addressed by the tagname and tagclass.</span>

<span class="sd">        Args:</span>
<span class="sd">            tagname (str): Name of the tag that shall be returned</span>
<span class="sd">            tagclass (int): ID of the tagclass - Default is the main genre class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The row of the specified tag, or ``None`` if no tag was found</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no name or valid tagclass was given</span>
<span class="sd">            TypeError: If *tagname* is not a string</span>
<span class="sd">            AssertionError: If more than one tag was found - This should never happen!</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tagname</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TagName must be given!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Name must be of type string!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tagclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_GENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_SUBGENRE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAG_CLASS_MOOD</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid tag class&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tags WHERE name = ? AND class = ?&quot;</span>
        <span class="k">with</span> <span class="n">MusicDatabaseLock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFromDatabase</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">tagname</span><span class="p">,</span> <span class="n">tagclass</span><span class="p">))</span>

        <span class="c1"># check result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Multiple Tag entries for one Tag-Name in the database!&quot;</span><span class="p">)</span>

        <span class="n">entry</span>  <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__TagEntryToDict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div></div>


<span class="c1"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4</span>

</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Ralf Stemmer.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>